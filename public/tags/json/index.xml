<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Json on rOpenSci - open tools for open science</title>
    <link>https://ropensci.org/tags/json/</link>
    <description>Recent content in Json on rOpenSci - open tools for open science</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Wed, 23 Oct 2013 00:00:00 +0000</lastBuildDate>
    
        <atom:link href="https://ropensci.org/tags/json/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Interactive maps with polygons using R, Geojson, and Github</title>
      <link>https://ropensci.org/blog/2013/10/23/style-geojson-polygon/</link>
      <pubDate>Wed, 23 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>https://ropensci.org/blog/2013/10/23/style-geojson-polygon/</guid>
      <description>
        
        

&lt;p&gt;Previously on this blog we have discussed making geojson maps and uploading to Github for interactive visualization &lt;a href=&#34;http://ropensci.org/blog/2013/07/04/rbison-geoson/&#34;&gt;with USGS BISON data&lt;/a&gt;, and &lt;a href=&#34;http://ropensci.org/blog/2013/07/17/style-geojson/&#34;&gt;with GBIF data&lt;/a&gt;, and on &lt;a href=&#34;http://sckott.github.io/2013/06/geojson/&#34;&gt;my own personal blog&lt;/a&gt;. This is done using a file format called &lt;a href=&#34;http://en.wikipedia.org/wiki/GeoJSON&#34;&gt;&lt;em&gt;geojson&lt;/em&gt;&lt;/a&gt;, a file format based on JSON (JavaScript Object Notation) in which you can specify geographic data along with any other metadata.&lt;/p&gt;

&lt;p&gt;In two the previous posts about &lt;em&gt;geojson&lt;/em&gt;, I described how you could get data from the USGS BISON API using our &lt;a href=&#34;https://github.com/ropensci/rbison&#34;&gt;rbison package&lt;/a&gt;, and from the GBIF API using the &lt;a href=&#34;https://github.com/ropensci/rgbif&#34;&gt;rgbif package&lt;/a&gt;, then make a &lt;em&gt;geojson&lt;/em&gt; file, and send to Github. In both examples, the data were points. What about polygons?  This is a relatively common use case in which an area is defined on a map instead of points - and polygons are supported in geojson.  How do we do this with the R to geojson to Github workflow?&lt;/p&gt;

&lt;p&gt;Using our package rgbif you can get a interactive map with polygons up on Github in just four lines of code! Of course creating a .shp file will take more than four lines of code.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;install-rgbif&#34;&gt;Install rgbif&lt;/h2&gt;

&lt;p&gt;You&amp;rsquo;ll need devtools packge to install rgbif from Github.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;install.packages(&amp;quot;devtools&amp;quot;)
library(devtools)
install_github(&amp;quot;rgbif&amp;quot;, &amp;quot;ropensci&amp;quot;, ref=&amp;quot;newapi&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;load-rgbif&#34;&gt;Load rgbif&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(rgbif)
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;make-the-map&#34;&gt;Make the map&lt;/h2&gt;

&lt;p&gt;There are various ways of getting a .shp file. I won&amp;rsquo;t go over those here, so we&amp;rsquo;ll just use a .shp file from the web. I downloaded a zip file for &lt;em&gt;Abies magnifica&lt;/em&gt; for its range map from the book &lt;em&gt;Atlas of United States Trees&lt;/em&gt; from &lt;a href=&#34;http://esp.cr.usgs.gov/data/little/&#34;&gt;this site&lt;/a&gt; - here is the link for the zip file: &lt;a href=&#34;http://esp.cr.usgs.gov/data/little/abiemagn.zip&#34;&gt;http://esp.cr.usgs.gov/data/little/abiemagn.zip&lt;/a&gt;. I unzipped the file locally on my machine, and here we just use the &lt;code&gt;abiemagn.shp&lt;/code&gt; file within that zip file.&lt;/p&gt;

&lt;p&gt;The first line of code in the next code block uses the function &lt;code&gt;togeojson&lt;/code&gt; to make a geojson file, which is written locally on your machine (a message tells you where it is located, but you can specify where you want it to go with the &lt;code&gt;destpath&lt;/code&gt; parameter). Note that the input argument to &lt;code&gt;togeojson&lt;/code&gt; goes to the directory for &lt;code&gt;abiemagn/abiemagn.shp&lt;/code&gt;, but for this to work you need the associated other two files, in this case: abiemagn.dbf and abiemagn.shx.&lt;/p&gt;

&lt;p&gt;The second line of code uses the &lt;code&gt;gist&lt;/code&gt; function to upload your .geojson file as a gist on Github.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;file &amp;lt;- &amp;quot;~/abiemagn/abiemagn.shp&amp;quot;
togeojson(input = file, method = &amp;quot;local&amp;quot;, outfilename = &amp;quot;abiesmagmap&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## Success! File is at /Users/scottmac2/abiesmagmap.geojson
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gist(&amp;quot;~/abiesmagmap.geojson&amp;quot;, description = &amp;quot;Abies magnifica polygons&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## Your gist has been published
## View gist at https://gist.github.com/sckott/7121053
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That&amp;rsquo;s it! The map is immediately available on the web, see &lt;a href=&#34;https://gist.github.com/sckott/7121053&#34;&gt;here&lt;/a&gt; for the one we just created. And you can embed the map too, like here:&lt;/p&gt;

&lt;!-- &lt;iframe src=&#34;https://gist.github.com/sckott/7121053?scroll=false&#34;&gt;&lt;/iframe&gt; --&gt;

&lt;script src=&#34;https://gist.github.com/sckott/7121053.js&#34;&gt;&lt;/script&gt;

      </description>
    </item>
    
    <item>
      <title>Style GeoJSON</title>
      <link>https://ropensci.org/blog/2013/07/17/style-geojson/</link>
      <pubDate>Wed, 17 Jul 2013 00:00:00 +0000</pubDate>
      
      <guid>https://ropensci.org/blog/2013/07/17/style-geojson/</guid>
      <description>
        
        

&lt;p&gt;&lt;a href=&#34;http://ropensci.org/blog/2013/07/04/rbison-geoson/&#34;&gt;Previously on this blog&lt;/a&gt; and on &lt;a href=&#34;http://sckott.github.io/2013/06/geojson/&#34;&gt;my own personal blog&lt;/a&gt;, I have discussed how easy it is to create interactive maps on Github using a combination of R, git and Github. This is done using a file format called &lt;a href=&#34;http://en.wikipedia.org/wiki/GeoJSON&#34;&gt;&lt;em&gt;geojson&lt;/em&gt;&lt;/a&gt;, a file format based on JSON (JavaScript Object Notation) in which you can specify geographic data along with any other metadata.&lt;/p&gt;

&lt;p&gt;In my &lt;a href=&#34;http://ropensci.org/blog/2013/07/04/rbison-geoson/&#34;&gt;previous post on this blog&lt;/a&gt; about &lt;em&gt;geojson&lt;/em&gt;, I described how you could get data from the USGS BISON API using our &lt;a href=&#34;https://github.com/ropensci/rbison&#34;&gt;rbison package&lt;/a&gt;, then make a &lt;em&gt;geojson&lt;/em&gt; file, then push to Github. Here, I describe briefly how you can style your map. This time, we&amp;rsquo;ll get data from &lt;a href=&#34;http://www.gbif.org/&#34;&gt;GBIF&lt;/a&gt; using the &lt;a href=&#34;https://github.com/ropensci/rgbif&#34;&gt;rgbif package&lt;/a&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;load-package&#34;&gt;Load package&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# install_github(&#39;rgbif&#39;, &#39;ropensci&#39;)
library(rgbif)
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;get-data-from-gbif&#34;&gt;Get data from GBIF&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;splist &amp;lt;- c(&amp;quot;Accipiter erythronemius&amp;quot;, &amp;quot;Junco hyemalis&amp;quot;, &amp;quot;Aix sponsa&amp;quot;)
out &amp;lt;- occurrencelist_many(splist, coordinatestatus = TRUE, maxresults = 100)
dat &amp;lt;- gbifdata(out)
head(dat)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;                taxonName decimalLatitude decimalLongitude
1 Accipiter erythronemius          -25.91           -54.36
2 Accipiter erythronemius          -25.86           -54.52
3 Accipiter erythronemius          -25.86           -54.52
4 Accipiter erythronemius          -27.35           -65.60
5 Accipiter erythronemius          -27.35           -65.60
6 Accipiter erythronemius          -27.35           -65.60
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;style&#34;&gt;Style&lt;/h2&gt;

&lt;p&gt;We first need to convert column names to be &lt;em&gt;latitude&lt;/em&gt; and &lt;em&gt;longitude&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;names(dat)[names(dat) %in% c(&amp;quot;decimalLatitude&amp;quot;, &amp;quot;decimalLongitude&amp;quot;)] &amp;lt;- c(&amp;quot;latitude&amp;quot;,
    &amp;quot;longitude&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then use a new function &lt;code&gt;stylegeojson&lt;/code&gt; to simply add new columns to the data.frame. With &lt;code&gt;stylegeojson&lt;/code&gt; you can add marker colors, symbols, and size. Note that this only works for point/marker maps (not polygon/line) for now. You could also simply edit the geojson file, but that can get very tedious with large files. You can specify color, symbol type, and symbol size all for the same variable, or each of those for different variables - where the ordering of the vector of colors, symbol types and sizes follows the ordering of the unique variable levels. Here we specify a separate color and size for each of the three species within the &lt;em&gt;taxonName&lt;/em&gt; variable.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;dat &amp;lt;- stylegeojson(input = dat, var = &amp;quot;taxonName&amp;quot;, color = c(&amp;quot;#976AAE&amp;quot;, &amp;quot;#6B944D&amp;quot;,
    &amp;quot;#BD5945&amp;quot;), size = &amp;quot;small&amp;quot;)
head(dat)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;                taxonName latitude longitude marker-color marker-size
1 Accipiter erythronemius   -25.91    -54.36      #976AAE       small
2 Accipiter erythronemius   -25.86    -54.52      #976AAE       small
3 Accipiter erythronemius   -25.86    -54.52      #976AAE       small
4 Accipiter erythronemius   -27.35    -65.60      #976AAE       small
5 Accipiter erythronemius   -27.35    -65.60      #976AAE       small
6 Accipiter erythronemius   -27.35    -65.60      #976AAE       small
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Here, specify one color for all three species, and make them all size medium.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;dat &amp;lt;- stylegeojson(input = dat, var = &amp;quot;taxonName&amp;quot;, color = &amp;quot;#6B944D&amp;quot;, size = &amp;quot;medium&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then write the data.frame to disk, and convert to a &lt;em&gt;geojson&lt;/em&gt; file using the function &lt;code&gt;togeojson&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;write.csv(dat, &amp;quot;~/github/sac/mygeojson/rgbif_data.csv&amp;quot;)
file &amp;lt;- &amp;quot;~/github/sac/mygeojson/rgbif_data.csv&amp;quot;
togeojson(file, method = &amp;quot;web&amp;quot;, destpath = &amp;quot;~/github/sac/mygeojson/&amp;quot;, outfilename = &amp;quot;rgbif_data&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;git-er-done&#34;&gt;Git &amp;lsquo;er done&lt;/h2&gt;

&lt;p&gt;All we need to do now is go to the command line or your git GUI client and push the changes to Github. If you need help with that see Step 3 in the &lt;a href=&#34;http://ropensci.org/blog/2013/07/04/rbison-geoson/&#34;&gt;previous geojson post&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Go &lt;a href=&#34;https://render.github.com/view/geojson?url=https://raw.github.com/sckott/mygeojson/master/rgbif_data.geojson&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt; to see the map.&lt;/p&gt;

&lt;p&gt;That&amp;rsquo;s it. have a look at your map, have fun, and let us know if you have any feature requests or bug reports at our Github issues tracker for rgbif &lt;a href=&#34;https://github.com/ropensci/rgbif/issues&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
