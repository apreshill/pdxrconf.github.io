<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | Magick 1.0: üé© ‚ú®üêá Advanced Graphics and Image Processing in R </title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article>
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h2 style="text-align: center;">Magick 1.0: üé© ‚ú®üêá Advanced Graphics and Image Processing in R </h2>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        
                          <a href="/about/#team"> Jeroen Ooms </a>&nbsp;
                        
                    
                </p>
                <br>
                <div style="font-size: 20px; color: #2C3E50; margin-top: 15px;">August 15, 2017</div>
            </div>
            <div class="col-offset-2 col-8 top-2">

                

                

<p>Last week, version 1.0 of the <a href="https://cran.r-project.org/web/packages/magick/index.html">magick</a> package appeared on CRAN: an ambitious effort to modernize and simplify high quality image processing in R. This R package builds upon the <a href="https://www.imagemagick.org/Magick++/STL.html">Magick++ STL</a> which exposes a powerful C++ API to the famous ImageMagick library.</p>

<p><img src="https://jeroen.github.io/images/magick.png" alt="RStudio Screenshot" /></p>

<p>The best place to start learning about magick is the <a href="https://cran.r-project.org/web/packages/magick/vignettes/intro.html">vignette</a> which gives a brief overview of the overwhelming amount of functionality in this package.</p>

<h3 id="towards-release-1-0">Towards Release 1.0</h3>

<p>Last year around this time rOpenSci <a href="https://ropensci.org/blog/blog/2016/08/23/z-magick-release">announced</a> the first release of the magick package: a new powerful toolkit for image reading, writing, converting, editing, transformation, annotation, and animation in R. Since the initial release there have been several updates with additional functionality, and many useRs have started to discover the power of this package to take visualization in R to the next level.</p>

<p>For example <a href="https://twitter.com/hrbrmstr/status/758304420224466944">Bob Rudis</a> uses magick to visualize California drought data from the U.S. Drought Monitor (click on the image to go find out more):</p>

<p><a href="https://rud.is/b/2016/07/27/u-s-drought-animations-with-the-witchs-brew-purrr-broom-magick/"><img src="https://jeroen.github.io/images/drought.gif" alt="drought" /></a></p>

<p>R-ladies <a href="http://www.lucymcgowan.com/">Lucy D&rsquo;Agostino McGowan</a> and <a href="http://www.masalmon.eu/">Ma√´lle Salmon</a> demonstrate how to make a beautiful collage:</p>

<p><a href="http://livefreeordichotomize.com/2017/07/18/the-making-of-we-r-ladies/"><img src="http://livefreeordichotomize.com/images/we-r-ladies.jpeg" alt="collage" /></a></p>

<p>And <a href="https://twitter.com/danielphadley/status/884845188979359744">Daniel P. Hadley</a> lets Vincent Vega explains Cars:</p>

<p><a href="http://danielphadley.com/ggplot-Logo/"><img src="http://danielphadley.com/images/Cars_Travolta.gif" alt="travolta" /></a></p>

<p>Now, 1 year later, the 1.0 release marks an important milestone: the addition of a new native graphics device (which serves as a hybrid between a magick image object and an R plot) bridges the gap between graphics and image processing in R.</p>

<p>This blog post explains how the magick device allows you to seamlessly combine graphing with image processing in R. You can either use it to post-process your R graphics, or draw on imported images using the native R plotting machinery. We hope that this unified interface will make it easier to produce beautiful, reproducible images with R.</p>

<h3 id="native-magick-graphics">Native Magick Graphics</h3>

<p>The <code>image_graph()</code> function opens a new graphics device similar to e.g. <code>png()</code> or <code>x11()</code>. It returns an image object to which the plot(s) will be written. Each page in the plotting device will become a frame (layer) in the image object.</p>

<pre><code class="language-r"># Produce image using graphics device
fig &lt;- image_graph(res = 96)
ggplot2::qplot(mpg, wt, data = mtcars, colour = cyl)
dev.off()
</code></pre>

<p>The <code>fig</code> object now contains the image that we can easily post-process. For example we can overlay another image:</p>

<pre><code class="language-r">logo &lt;- image_read(&quot;https://www.r-project.org/logo/Rlogo.png&quot;)
out &lt;- image_composite(fig, image_scale(logo, &quot;x150&quot;), offset = &quot;+80+380&quot;)

# Show preview
image_browse(out)

# Write to file
image_write(out, &quot;myplot.png&quot;)
</code></pre>

<p><img src="/assets/blog-images/2017-08-15-magick-10/out.png" alt="out" /></p>

<h3 id="drawing-device">Drawing Device</h3>

<p>The <code>image_draw()</code> function opens a graphics device to draw on top of an existing image using pixel coordinates.</p>

<pre><code class="language-r"># Open a file
library(magick)
frink &lt;- image_read(&quot;https://jeroen.github.io/images/frink.png&quot;)
drawing &lt;- image_draw(frink)
</code></pre>

<p><img src="https://jeroen.github.io/images/frink.png" alt="frink" /></p>

<p>We can now use R&rsquo;s native low-level graphics functions for drawing on top of the image:</p>

<pre><code class="language-r">rect(20, 20, 200, 100, border = &quot;red&quot;, lty = &quot;dashed&quot;, lwd = 5)
abline(h = 300, col = 'blue', lwd = '10', lty = &quot;dotted&quot;)
text(10, 250, &quot;Hoiven-Glaven&quot;, family = &quot;courier&quot;, cex = 4, srt = 90)
palette(rainbow(11, end = 0.9))
symbols(rep(200, 11), seq(0, 400, 40), circles = runif(11, 5, 35),
  bg = 1:11, inches = FALSE, add = TRUE)
</code></pre>

<p>At any point you can inspect the current result:</p>

<pre><code>image_browse(drawing)
</code></pre>

<p><img src="/assets/blog-images/2017-08-15-magick-10/drawing.png" alt="drawing" /></p>

<p>Once you are done you can close the device and save the result.</p>

<pre><code class="language-r">dev.off()
image_write(drawing, 'drawing.png')
</code></pre>

<p>By default <code>image_draw()</code> sets all margins to 0 and uses graphics coordinates to match image size in pixels (width x height) where (0,0) is the top left corner. Note that this means the y axis increases from top to bottom which is the opposite of typical graphics coordinates. You can override all this by passing custom <code>xlim</code>, <code>ylim</code> or <code>mar</code> values to <code>image_draw()</code>.</p>

<h3 id="animated-graphics">Animated Graphics</h3>

<p>The graphics device supports multiple frames which makes it easy to create animated graphics. The example below shows how you would implement the example from the very cool <a href="https://github.com/dgrtwo/gganimate">gganimate</a> package using the magick.</p>

<pre><code class="language-r">library(gapminder)
library(ggplot2)
library(magick)
img &lt;- image_graph(res = 96)
datalist &lt;- split(gapminder, gapminder$year)
out &lt;- lapply(datalist, function(data){
  p &lt;- ggplot(data, aes(gdpPercap, lifeExp, size = pop, color = continent)) +
    scale_size(&quot;population&quot;, limits = range(gapminder$pop)) +
    scale_x_log10(limits = range(gapminder$gdpPercap)) +
    geom_point() + ylim(20, 90) +  ggtitle(data$year) + theme_classic()
  print(p)
})
dev.off()
animation &lt;- image_animate(img, fps = 2)
image_write(animation, &quot;animation.gif&quot;)
</code></pre>

<p><img src="/assets/blog-images/2017-08-15-magick-10/animation.gif" alt="animation" /></p>

<p>We hope that the magick package can provide a more robust back-end for packages like gganimate to produce interactive graphics in R without requiring the user to manually install external image editing software.</p>

<h3 id="porting-imagemagick-commands-to-r">Porting ImageMagick Commands to R</h3>

<p>The magick 1.0 release now has the core image processing functionality that you expect from an image processing package. But there is still a lot of room for improvement to make magick <em>the</em> image processing package in R.</p>

<p>A lot of R users and packages currently shell out to ImageMagick command line tools for performing image manipulations. The goal is to support all these operations in the magick package, so that the images can be produced (and reproduced!) on any platform without requiring the user to install additional software.</p>

<p>Note that ImageMagick library is over 26 years old and has accumulated an enormous number of features in those years. Porting all of this to R is quite a bit of work, for which feedback from users is important. If there is an imagemagick operation that you like to do in R but you can&rsquo;t figure out how, please <a href="https://github.com/ropensci/magick/issues">open an issue</a> on GitHub. If the functionality is currently not supported yet, we will try to add it to the next version.</p>

<h3 id="image-analysis">Image Analysis</h3>

<p>Currently magick is focused on generating and editing images. There is yet another entirely different set of features which we like to support related to analyzing images. Image analysis can involve anything from calculating color distributions to more sophisticated feature extraction and vision tools. I am not very familiar with this field, so again we could use suggestions from users and experts.</p>

<p>One feature that is already available is the <code>image_ocr()</code> function which extracts text from the image using the rOpenSci <a href="https://ropensci.org/blog/blog/2016/11/16/tesseract">tesseract</a> package. Another cool example of using image analysis is the <a href="https://github.com/ThinkRstat/collage">collage</a> package which calculates <a href="https://github.com/ThinkRstat/collage#histograms">color histograms</a> to select appropriate tile images for creating a collage.</p>

<p><a href="https://github.com/ThinkRstat/collage#histograms"><img src="https://github.com/ThinkRstat/collage/raw/master/README-histograms-2.png" alt="histogram" /></a></p>

<p>As part of supporting supporting analysis tools we plan to extract the bitmap (raster) classes into a separate package. This will enable package authors to write R extensions to analyze and manipulate on the raw image data, without necessarily depending on magick. Yet the user can always rely on magick as a powerful toolkit to import/export images and graphics into such low level bitmaps.</p>

<div class="col-sm-11 col-sm-offset-1">
<blockquote class="twitter-tweet" data-lang="en">
<a href="https://twitter.com/grbails/status/885543687559811073"></a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>

            </div>
            <br>
            <div class="col-offset-2 col-8 top-4 labels">
                
                    <a href="/tags/r"><span class="label">r</span></a>
                
                    <a href="/tags/packages"><span class="label">packages</span></a>
                
                    <a href="/tags/software"><span class="label">software</span></a>
                
                    <a href="/tags/images"><span class="label">images</span></a>
                
                    <a href="/tags/magick"><span class="label">magick</span></a>
                
            </div>

            
            
            <div class="col-offset-2 col-8 top-4">
                <div id='discourse-comments'></div>
                <script type="text/javascript">
                DiscourseEmbed = { discourseUrl: 'https://discuss.ropensci.org/',
                                   topicId:  826  };
                (function() {
                  var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
                  d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
                })();
                </script>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



