<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | Species occurrence data to CartoDB</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article>
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h2 style="text-align: center;">Species occurrence data to CartoDB</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        
                          <a href="/about/#team"> Scott Chamberlain </a>&nbsp;
                        
                    
                </p>
                <br>
                <div style="font-size: 20px; color: #2C3E50; margin-top: 15px;">November 4, 2013</div>
            </div>
            <div class="col-offset-2 col-8 top-2">

                

                

<p>We have previously written about creating interactive maps on the web from R, with the interactive maps on Github. See <a href="http://ropensci.org/blog/2013/10/23/style-geojson-polygon/">here</a>, <a href="http://ropensci.org/blog/2013/07/17/style-geojson/">here</a>, <a href="http://ropensci.org/blog/2013/07/04/rbison-geoson/">here</a>, and <a href="http://recology.info/2013/06/geojson/">here</a>.</p>

<p>A different approach is to use <a href="http://cartodb.com/">CartoDB</a>, <a href="http://cartodb.com/pricing/">a freemium service</a> with sql interface to your data tables that provides a map to visualize data in those tables. They released an R interace to their sql API <a href="https://github.com/Vizzuality/cartodb-r">on Github here</a> - which we can use to make an interactive map from R.</p>

<p>We&rsquo;ll first get some data from GBIF, ~500 occurrences of <em>Puma concolor</em> in the US, then push that data to a CartoDB table. There are a couple more non-programmatic steps in this workflow than with pushing geojson file to Github as outlined in the previous linked above (i.e., going to the CartoDB site and making a visualization, and making it public).</p>

<hr />

<h2 id="install-packages">Install packages</h2>

<pre><code class="language-r">install.packages(&quot;devtools&quot;)
library(devtools)
install_github(&quot;rgbif&quot;, &quot;ropensci&quot;, ref = &quot;newapi&quot;)
install_github(&quot;cartodb-r&quot;, &quot;Vizzuality&quot;, subdir = &quot;CartoDB&quot;)
</code></pre>

<h2 id="load-em">Load em</h2>

<pre><code class="language-r">library(rgbif)
library(CartoDB)
</code></pre>

<hr />

<h2 id="get-some-data-from-gbif">Get some data from GBIF</h2>

<p>Here, we&rsquo;ll get data for Puma concolor, the <em>hello, world</em> for biodiversity data.</p>

<pre><code class="language-r">key &lt;- gbif_lookup(name = &quot;Puma concolor&quot;, kingdom = &quot;animals&quot;)$speciesKey
data &lt;- occ_search(taxonKey = key, limit = 500, georeferenced = TRUE, country = &quot;US&quot;,
    return = &quot;data&quot;)
head(data)
</code></pre>

<pre><code>##                             name longitude latitude
## 1 Puma concolor (Linnaeus, 1771)    -108.9    32.70
## 2 Puma concolor (Linnaeus, 1771)    -108.0    32.88
## 3 Puma concolor (Linnaeus, 1771)    -105.5    32.95
## 4 Puma concolor (Linnaeus, 1771)    -107.8    33.61
## 5 Puma concolor (Linnaeus, 1771)    -107.5    33.00
## 6 Puma concolor (Linnaeus, 1771)    -106.5    36.69
</code></pre>

<pre><code class="language-r">str(data)
</code></pre>

<pre><code>## 'data.frame':	500 obs. of  3 variables:
##  $ name     : Factor w/ 7 levels &quot;Animalia&quot;,&quot;Carnivora&quot;,..: 7 7 7 7 7 7 7 7 7 7 ...
##  $ longitude: num  -109 -108 -105 -108 -107 ...
##  $ latitude : num  32.7 32.9 33 33.6 33 ...
</code></pre>

<p>Great, we have some data. Now let&rsquo;s make a map.</p>

<hr />

<h2 id="push-data-up-to-cartodb">Push data up to CartoDB</h2>

<p>I frist crated a table in my CartoDB account named <code>pumamap</code>. Then, I need to initialize the connection with CartoDB with my account name and API key. Note that I am pulling up my key from my .Rprofile file on my machine for ease and so it&rsquo;s not revealed to you :)</p>

<pre><code class="language-r">key = getOption(&quot;mycartodbkey&quot;)
cartodb(&quot;recology&quot;, api.key = key)
</code></pre>

<p>Now we need to push data to our <code>pumamap</code> table using the function <code>cartodb.row.insert</code>. It accepts one row of data, so we&rsquo;ll pass each row of data with an <code>lapply</code> call.</p>

<pre><code class="language-r">rows &lt;- apply(data, 1, as.list)
lapply(rows, function(x) cartodb.row.insert(name = &quot;pumamap&quot;, columns = list(&quot;name&quot;,
    &quot;longitude&quot;, &quot;latitude&quot;), values = x))
</code></pre>

<p>After the upload is finished, I had to make sure the table was georeferenced, and played with settings to suit my style. And then I made a visualization from the <code>pumamap</code> dataset and made it public. And that&rsquo;s it!  You can find the map <a href="http://cdb.io/1fbvgCG">here</a>, and it can be embedded:</p>

<p><br><br><br></p>

<iframe width='100%' height='400' frameborder='0' src='http://recology.cartodb.com/viz/76a5598e-444b-11e3-8a8c-5404a6a69006/embed_map?title=false&description=false&search=false&shareable=false&cartodb_logo=true&layer_selector=false&legends=false&scrollwheel=true&sublayer_options=1&sql=&zoom=3&center_lat=37.61423141542417&center_lon=-100.72265625'></iframe>

<p><br><br></p>

<p>And we can examine a row from the table in our CartoDB account with a single line of code</p>

<pre><code class="language-r">cartodb.row.get(name = &quot;pumamap&quot;, cartodb_id = 10)
</code></pre>

<pre><code>##   cartodb_id                           name description
## 1          1 Puma concolor (Linnaeus, 1771)        NULL
##                 created_at               updated_at
## 1 2013-11-03T06:40:12+0100 2013-11-03T06:46:55+0100
##                                             the_geom the_geom_webmercator
## 1 0101000020E610000089247A19C5365BC08C15359886594040                 NULL
##   latitude longitude
## 1     32.7    -108.9
</code></pre>

            </div>
            <br>
            <div class="col-offset-2 col-8 top-4 labels">
                
                    <a href="/tags/r"><span class="label">R</span></a>
                
                    <a href="/tags/rgbif"><span class="label">rgbif</span></a>
                
                    <a href="/tags/api"><span class="label">API</span></a>
                
                    <a href="/tags/cartodb"><span class="label">cartodb</span></a>
                
                    <a href="/tags/maps"><span class="label">maps</span></a>
                
            </div>

            
            
            <div class="col-offset-2 col-8 top-4">
              <div id="disqus_thread"></div>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                var disqus_shortname = 'ropenscience';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



