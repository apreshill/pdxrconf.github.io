<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | Overlaying climate data with species occurrence data</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article>
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h2 style="text-align: center;">Overlaying climate data with species occurrence data</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        
                          <a href="/about/#team"> Ted Hart </a>&nbsp;
                        
                    
                </p>
                <br>
                <div style="font-size: 20px; color: #2C3E50; margin-top: 15px;">July 29, 2013</div>
            </div>
            <div class="col-offset-2 col-8 top-2">

                

                

<p>One of our primary goals at ROpenSci is to wrap as many science API&rsquo;s as possible.  While each package can be used as a standalone interface, there&rsquo;s lots of ways our packages can overlap and complement each other.  Sure <a href="http://www.youtube.com/watch?v=7yeA7a0uS3A">He-Man</a> usually rode <a href="http://en.wikipedia.org/wiki/Battle_Cat">Battle Cat</a>, but there&rsquo;s no reason he couldn&rsquo;t ride a <a href="http://drawception.com/pub/panels/2012/5-14/swgpnXLCRm-8.png">my little pony</a> sometimes too.  That&rsquo;s the case with our packages for <a href="http://www.gbif.org/">GBIF</a> and the <a href="http://data.worldbank.org/developers/climate-data-api">worldbank climate data api</a>.  Both packages will give you lots and lots of data, but a shared feature of both is the ability to plot spatial information.  The <a href="https://github.com/ropensci/rWBclimate">rWBclimate</a> package provides a robust mapping ability on top of access to climate data.  At it&rsquo;s most bare bones, it can be used as alternative to the built in mapping facilities included in <a href="https://github.com/ropensci/rgbif/">rgbif</a>.  Building on the example in the <a href="http://www.ropensci.org/tutorials/rgbif_tutorial.html#occurrencelist">rgbif tutorial</a> we&rsquo;ll plot data for two species in the US and Mexico, the dark eyed junco (<em>Junco hyemalis</em>) and the wood duck (<em>Aix sponsa</em>).  Here&rsquo;s how you can use the kml interface from rWBclimate to download a map of the US and Mexico and overlay it with data from rgbif.
<br></p>

<pre><code class="language-r">
library(ggplot2)
library(rWBclimate)
library(rgbif)
## Grab some occurrence data

splist &lt;- c(&quot;Junco hyemalis&quot;, &quot;Aix sponsa&quot;)
out &lt;- occurrencelist_many(splist, coordinatestatus = TRUE, maxresults = 1000)

## Set the map data path
options(kmlpath = &quot;/Users/edmundhart/kmltemp&quot;)
sp.map.df &lt;- create_map_df(c(&quot;USA&quot;,&quot;MEX&quot;))

## create map plot
sp.map &lt;- ggplot(sp.map.df,aes(x=long,y=lat,group=group))+geom_polygon(fill=&quot;white&quot;,colour=&quot;black&quot;)+xlim(-130,-65)+ylim(12,50)

## Overlay occurrence data
sp.map + geom_point(data=gbifdata(out),aes(y=decimalLatitude,x=decimalLongitude,group=taxonName,colour=taxonName))

</code></pre>

<p><br>
<img src="/assets/blog-images/2013-07-29-rWBclimate-rgbif/gbifmap1.png" alt="center" /></p>

<hr />

<p><br></p>

<h2 id="overlaying-climate-data-with-occurrence-data">Overlaying climate data with occurrence data</h2>

<p><br></p>

<p>So that&rsquo;s how you could make a basic map, but what if you want to overlay climate data with occurrence data?  That&rsquo;s easy too.  You repeat essentially the same steps as above, but be sure to grab some climate data too. In this example I&rsquo;ve chose to grab data for 8 different tree species that exhibit somewhat of a lattitudinal gradient.  I&rsquo;ll map them on top of historical temperature data.  In this case I&rsquo;ll be using the average annual temperature from 1990 to 2000.  Because I want a bit better spatial resolution I&rsquo;ll be using basin level data instead of country level data.</p>

<pre><code class="language-r">
### Download map data
usmex &lt;- c(273:284,328:365)
usmex.basin &lt;- create_map_df(usmex)

## Download temperature data
temp.dat &lt;- get_historical_temp(usmex, &quot;decade&quot; )
temp.dat &lt;- subset(temp.dat,temp.dat$year == 2000 )


#create my climate map
usmex.map.df &lt;- climate_map(usmex.basin,temp.dat,return_map=F)


## Grab some species occurrence data for the 8 tree species.

splist &lt;- c(&quot;Acer saccharum&quot;,
            &quot;Abies balsamea&quot;,
            &quot;Arbutus texana&quot;,
            &quot;Betula alleghaniensis&quot;,
            &quot;Chilopsis linearis&quot;,
            &quot;Conocarpus erectus&quot;,
            &quot;Populus tremuloides&quot;,
            &quot;Larix laricina&quot;)
out &lt;- occurrencelist_many(splist, coordinatestatus=TRUE, maxresults=1000, fixnames=&quot;match&quot;)

## Now just create the base temperature map
usmex.map &lt;- ggplot()+geom_polygon(data=usmex.map.df,aes(x=long,y=lat,group=group,fill=data,alpha=.8))+scale_fill_continuous(&quot;Average annual \n temp: 1990-2000&quot;,low=&quot;yellow&quot;,high=&quot;red&quot;)+ guides(alpha=F)+theme_bw()


## And overlay of gbif data
usmex.map + geom_point(data=gbifdata(out),aes(y=decimalLatitude,x=decimalLongitude,group=taxonName,colour= taxonName)) + xlim(-125,-59)+ylim(5,55)

</code></pre>

<p><br>
<img src="/assets/blog-images/2013-07-29-rWBclimate-rgbif/gbifmap2.png" alt="center" /></p>

<p>The map doesn&rsquo;t have borders because it&rsquo;s created at the basin level, but it would be easy enough to add an outline for the countries.  You could also plot any of your own data over climate maps because they are based on decimal lattitude and longitude coordinates, or data from multiple sources.</p>

            </div>
            <br>
            <div class="col-offset-2 col-8 top-4 labels">
                
                    <a href="/tags/r"><span class="label">R</span></a>
                
                    <a href="/tags/api"><span class="label">API</span></a>
                
                    <a href="/tags/climate"><span class="label">climate</span></a>
                
                    <a href="/tags/maps"><span class="label">maps</span></a>
                
                    <a href="/tags/gbif"><span class="label">gbif</span></a>
                
                    <a href="/tags/ecology"><span class="label">ecology</span></a>
                
            </div>

            
            
            <div class="col-offset-2 col-8 top-4">
              <div id="disqus_thread"></div>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                var disqus_shortname = 'ropenscience';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



