<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | Changed and new things in the new version of rgbif, v0.5</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article>
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h2 style="text-align: center;">Changed and new things in the new version of rgbif, v0.5</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        
                          <a href="/about/#team"> Scott Chamberlain </a>&nbsp;
                        
                    
                </p>
                <br>
                <div style="font-size: 20px; color: #2C3E50; margin-top: 15px;">February 17, 2014</div>
            </div>
            <div class="col-offset-2 col-8 top-2">

                

                

<p><code>rgbif</code> is an R package to search and retrieve data from the Global Biodiverity Information Facilty (GBIF). <code>rgbif</code> wraps R code around the [GBIF API][gbifapi] to allow you to talk to GBIF from R.</p>

<p>We just pushed a new verion of <code>rgbif</code> to cran - v0.5.0.  Source and binary files are now available on CRAN.</p>

<p>There are a few new functions: <code>count_facet</code>, <code>elevation</code>, and <code>installations</code>.  These are described, with examples, below.</p>

<p>Functions to work with the old GBIF API remain in the package, but will be removed as soon as the old API is no longer supported by GBIF. See <code>rgbif-deprecated</code> in the help for the package.</p>

<p>Note: you can see a detailed list of all changes in new versions on the releases page for <code>rgbif</code> on Githb here: <a href="https://github.com/ropensci/rgbif/releases">https://github.com/ropensci/rgbif/releases</a></p>

<hr />

<h2 id="install-rgbif-and-dependencies">Install rgbif and dependencies</h2>

<pre><code class="language-r">install.packages(&quot;rgbif&quot;)
</code></pre>

<h2 id="load-rgbif-and-dependencies">Load rgbif and dependencies</h2>

<pre><code class="language-r">library(rgbif)
</code></pre>

<h2 id="new-functions">New functions</h2>

<h3 id="new-function-count-facet">New function: count_facet</h3>

<p>Does facetted count searches, as GBIF doesn&rsquo;t allow faceted searches against the count API. In this example, we have a set of species names, and we want counts by each of a set of 20 countries for each species. This function wraps up some code to essentially give you faceted search capability for the count service - of course this is much slower than if it was done server side.</p>

<pre><code class="language-r">spplist &lt;- c(&quot;Geothlypis trichas&quot;, &quot;Tiaris olivacea&quot;, &quot;Pterodroma axillaris&quot;,
    &quot;Calidris ferruginea&quot;, &quot;Pterodroma macroptera&quot;, &quot;Gallirallus australis&quot;,
    &quot;Falco cenchroides&quot;, &quot;Telespiza cantans&quot;, &quot;Oreomystis bairdi&quot;, &quot;Cistothorus palustris&quot;)
keys &lt;- sapply(spplist, function(x) name_backbone(x, rank = &quot;species&quot;)$usageKey)
library(plyr)
keys &lt;- compact(keys)
count_facet(by = &quot;country&quot;, countries = 20, removezeros = TRUE)
</code></pre>

<pre><code>##                 country       V1
## 1               ANDORRA    96379
## 2  UNITED_ARAB_EMIRATES   273098
## 3           AFGHANISTAN    64020
## 4       ANTIGUA_BARBUDA    12090
## 5              ANGUILLA    13188
## 6               ALBANIA     8202
## 7               ARMENIA    26253
## 8                ANGOLA   168412
## 9            ANTARCTICA  1068590
## 10            ARGENTINA  1155372
## 11       AMERICAN_SAMOA    12248
## 12              AUSTRIA  2702533
## 13            AUSTRALIA 38729449
## 14                ARUBA     8178
## 15        ALAND_ISLANDS      566
## 16           AZERBAIJAN    17622
## 17   BOSNIA_HERZEGOVINA    10050
## 18             BARBADOS    21683
## 19           BANGLADESH    24255
## 20              BELGIUM  5167393
</code></pre>

<h3 id="new-function-elevation">New function: elevation</h3>

<p>Gets elevation data for a <code>data.frame</code> of lat/long points, or a list of lat/long points. This function uses the Google Elevation API.</p>

<p>You can get elevation/altitude data back from the GBIF API, but that data is often missing. See the <code>altitude</code> column in data output from <code>occ_search</code> - you need to set the fields parameter to <em>all</em> or ask for <em>altitude</em> explicitly.</p>

<pre><code class="language-r">key &lt;- name_backbone(name = &quot;Puma concolor&quot;, kingdom = &quot;plants&quot;)$speciesKey
dat &lt;- occ_search(taxonKey = key, return = &quot;data&quot;, limit = 10, georeferenced = TRUE)
head(dat)
</code></pre>

<pre><code>##            name       key longitude latitude
## 1 Puma concolor 866527350   -110.58    31.85
## 2 Puma concolor 866545169   -103.60    29.16
## 3 Puma concolor 866495627   -106.39    35.13
## 4 Puma concolor 866498665    -89.43    20.31
## 5 Puma concolor 866508658   -105.04    19.47
## 6 Puma concolor 866523280   -118.24    34.06
</code></pre>

<p>Attach elevation data to the <code>data.frame</code></p>

<pre><code class="language-r">head(elevation(dat))
</code></pre>

<pre><code>##            name       key longitude latitude elevation
## 1 Puma concolor 866527350   -110.58    31.85   1294.62
## 2 Puma concolor 866545169   -103.60    29.16    665.03
## 3 Puma concolor 866495627   -106.39    35.13   2250.25
## 4 Puma concolor 866498665    -89.43    20.31     29.05
## 5 Puma concolor 866508658   -105.04    19.47     69.82
## 6 Puma concolor 866523280   -118.24    34.06     93.25
</code></pre>

<h3 id="new-function-installations">New function: installations</h3>

<p>Gets metdata on installations via the <a href="http://www.gbif.org/developer/registry#installations">installations API</a>.</p>

<p>This example requests data for installations with the query terms &lsquo;france&rsquo; in the metadata. We&rsquo;ll just look at the first result, and just the description and its first contact.</p>

<pre><code class="language-r">df &lt;- installations(query = &quot;france&quot;)
df$results[[1]]$description
</code></pre>

<pre><code>## [1] &quot;Natural Science Collections from the University of Alberta&quot;
</code></pre>

<pre><code class="language-r">df$results[[1]]$contacts[[1]]
</code></pre>

<pre><code>## $key
## [1] 18037
##
## $type
## [1] &quot;TECHNICAL_POINT_OF_CONTACT&quot;
##
## $primary
## [1] TRUE
##
## $firstName
## [1] &quot;Jim Whittome&quot;
##
## $email
## [1] &quot;jim.whittome@ualberta.ca&quot;
##
## $createdBy
## [1] &quot;registry-migration.gbif.org&quot;
##
## $modifiedBy
## [1] &quot;registry-migration.gbif.org&quot;
##
## $created
## [1] &quot;2013-02-26T22:15:50.000+0000&quot;
##
## $modified
## [1] &quot;2013-03-18T16:17:46.000+0000&quot;
</code></pre>

<p>Another example, just requesting contact data for an installation identifier (i.e. uuid).</p>

<pre><code class="language-r">installations(data = &quot;contact&quot;, uuid = &quot;2e029a0c-87af-42e6-87d7-f38a50b78201&quot;)
</code></pre>

<pre><code>## [[1]]
## [[1]]$key
## [1] 19952
##
## [[1]]$type
## [1] &quot;TECHNICAL_POINT_OF_CONTACT&quot;
##
## [[1]]$primary
## [1] TRUE
##
## [[1]]$firstName
## [1] &quot;Biodiversity Informatics Manager&quot;
##
## [[1]]$email
## [1] &quot;bdim@ansp.org&quot;
##
## [[1]]$createdBy
## [1] &quot;registry-migration.gbif.org&quot;
##
## [[1]]$modifiedBy
## [1] &quot;2e029a0c-87af-42e6-87d7-f38a50b78201&quot;
##
## [[1]]$created
## [1] &quot;2013-07-22T18:17:06.000+0000&quot;
##
## [[1]]$modified
## [1] &quot;2014-01-10T20:03:03.867+0000&quot;
</code></pre>

<h2 id="minor-changes">Minor changes</h2>

<h3 id="sapply-vapply">sapply -&gt; vapply</h3>

<p>We replaced <code>sapply</code> with <code>vapply</code> as <code>vapply</code> can be faster than <code>sapply</code>, and with <code>vapply</code> you can include a check in the function call to make sure that the returned data elements are of the correct type.</p>

<h3 id="other-minor-changes">Other minor changes</h3>

<ul>
<li>Changed name of <code>country_codes</code> function to <code>gbif_country_codes</code> to avoid conflicts with other packages.</li>
<li><code>gbifmap</code> now plots a map with <code>ggplot2::coord_fixed(ratio=1)</code> so that you don&rsquo;t get wonky maps.</li>
<li><code>occ_count</code> now accepts a call to query publishingCountry with a single parameter (country), to list occurrence counts by publishing country.</li>
<li><code>occ_get</code> and <code>occ_search</code> lose parameter minimal, and in its place gains parameter fields, in which you can request fields=&lsquo;minimal&rsquo; to get just name, taxon key, lat and long. Or set to &lsquo;all&rsquo; to get all fields, or selection the fields you want by passing in a vector of field names.</li>
<li>Updated base url for the GIBF parser function <code>parsenames</code></li>
<li>isocodes dataset now with documentation.</li>
</ul>

            </div>
            <br>
            <div class="col-offset-2 col-8 top-4 labels">
                
                    <a href="/tags/r"><span class="label">R</span></a>
                
                    <a href="/tags/api"><span class="label">API</span></a>
                
                    <a href="/tags/gbif"><span class="label">gbif</span></a>
                
            </div>

            
            
            <div class="col-offset-2 col-8 top-4">
              <div id="disqus_thread"></div>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                var disqus_shortname = 'ropenscience';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



