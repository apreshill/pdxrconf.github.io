<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | solr - an R interface to Solr</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article>
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h2 style="text-align: center;">solr - an R interface to Solr</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        
                          <a href="/about/#team"> Scott Chamberlain </a>&nbsp;
                        
                    
                </p>
                <br>
                <div style="font-size: 20px; color: #2C3E50; margin-top: 15px;">January 27, 2014</div>
            </div>
            <div class="col-offset-2 col-8 top-2">

                

                

<p>A number of the APIs we interact with (e.g., PLOS full text API, and USGS&rsquo;s BISON API in <a href="http://cran.r-project.org/web/packages/rplos/index.html">rplos</a> and <a href="http://cran.r-project.org/web/packages/rbison/index.html">rbison</a>, respectively) expose <a href="http://lucene.apache.org/solr/">Solr</a> endpoints. <a href="http://lucene.apache.org/solr/">Solr</a> is an Apache hosted project - it is a powerful search server.  Given that at least two, and possibly more in the future, of the data providers we interact with provide Solr endpoints, it made sense to create an R package to make robust functions to interact with Solr that work across any Solr endpoint. This is then useful to us, and hopefully others.</p>

<p>The following are a few examples covering some of things you can do in Solr that fall in to six categories:</p>

<ul>
<li>Search: via <code>solr_search</code></li>
<li>Grouping: via <code>solr_group</code></li>
<li>Faceting: via <code>solr_facet</code></li>
<li>Highlighting: via <code>solr_highlight</code></li>
<li>Stats: via <code>solr_stats</code></li>
<li>More like this: via <code>solr_mlt</code></li>
</ul>

<p>The <code>solr</code> package generally has two steps for any query: a) send the request given your inputs, and b) parse the output into a useful R data structure. Part a) is quite easy. However, part b) is harder. We are working hard on making parsers that are as general as possible for each of the data formats that are returned by group, facet, highlight, etc., but of course we will still definitely fail in many cases. Please do submit bug reports to <a href="https://github.com/ropensci/solr/issues?state=open">our issue tracker</a> so we can make the parsers work better.</p>

<hr />

<h2 id="installation">Installation</h2>

<p><code>solr</code> is on CRAN, so you can install the more stable version there, and some dependencies.</p>

<pre><code class="language-r">install.packages(&quot;solr&quot;)
</code></pre>

<p>You can install the development version from Github as follows.  Below we&rsquo;ll use the Github version - most of below is available in the CRAN version too, except <code>solr_group</code>.</p>

<pre><code class="language-r">install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;ropensci/solr&quot;)
</code></pre>

<p>Load the library</p>

<pre><code class="language-r">library(&quot;solr&quot;)
</code></pre>

<hr />

<h2 id="define-url-endpoint-and-key">Define url endpoint and key</h2>

<p>As <code>solr</code> is a general interface to Solr endpoints, you need to define the url. Here, we&rsquo;ll work with the Public Library of Science full text search API (docs <a href="http://api.plos.org/">here</a>). Some Solr endpoints will require authentication - I should note that we don&rsquo;t yet handle authentication schemes other than passing in a key in the url, but that&rsquo;s on the to do list.</p>

<pre><code class="language-r">url &lt;- 'http://api.plos.org/search'
</code></pre>

<hr />

<h2 id="search">Search</h2>

<pre><code class="language-r">solr_search(q='*:*', rows=2, fl='id', base=url)
#&gt;                                                              id
#&gt; 1       10.1371/annotation/c313df3a-52bd-4cbe-af14-6676480d1a43
#&gt; 2 10.1371/annotation/c313df3a-52bd-4cbe-af14-6676480d1a43/title
</code></pre>

<p>Search for words &ldquo;sports&rdquo; and &ldquo;alcohol&rdquo; within seven words of each other</p>

<pre><code class="language-r">solr_search(q='everything:&quot;sports alcohol&quot;~7', fl='title', rows=3, base=url)
#&gt;                                                                                                                                                                         title
#&gt; 1                                      Alcohol Ingestion Impairs Maximal Post-Exercise Rates of Myofibrillar Protein Synthesis following a Single Bout of Concurrent Training
#&gt; 2 “Like Throwing a Bowling Ball at a Battle Ship” Audience Responses to Australian News Stories about Alcohol Pricing and Promotion Policies: A Qualitative Focus Group Study
#&gt; 3                                            Development and Validation of a Risk Score Predicting Substantial Weight Gain over 5 Years in Middle-Aged European Men and Women
</code></pre>

<hr />

<h2 id="groups">Groups</h2>

<p>Most recent publication by journal</p>

<pre><code class="language-r">solr_group(q='*:*', group.field='journal', rows=5, group.limit=1, group.sort='publication_date desc', fl='publication_date, score', base=url)
#&gt;       groupValue numFound start     publication_date score
#&gt; 1       plos one   931323     0 2014-11-24T00:00:00Z     1
#&gt; 2  plos genetics    40603     0 2014-11-20T00:00:00Z     1
#&gt; 3  plos medicine    18514     0 2014-11-18T00:00:00Z     1
#&gt; 4 plos pathogens    35497     0 2014-11-24T00:00:00Z     1
#&gt; 5   plos biology    26133     0 2014-11-18T00:00:00Z     1
</code></pre>

<p>First publication by journal</p>

<pre><code class="language-r">solr_group(q='*:*', group.field='journal', group.limit=1, group.sort='publication_date asc', fl='publication_date, score', fq=&quot;publication_date:[1900-01-01T00:00:00Z TO *]&quot;, base=url)
#&gt;                          groupValue numFound start     publication_date
#&gt; 1                          plos one   931323     0 2006-12-01T00:00:00Z
#&gt; 2                     plos genetics    40603     0 2005-06-17T00:00:00Z
#&gt; 3                     plos medicine    18514     0 2004-09-07T00:00:00Z
#&gt; 4                    plos pathogens    35497     0 2005-07-22T00:00:00Z
#&gt; 5                      plos biology    26133     0 2003-08-18T00:00:00Z
#&gt; 6                              none    57566     0 2005-08-23T00:00:00Z
#&gt; 7        plos computational biology    29838     0 2005-06-24T00:00:00Z
#&gt; 8  plos neglected tropical diseases    25119     0 2007-08-30T00:00:00Z
#&gt; 9              plos clinical trials      521     0 2006-04-21T00:00:00Z
#&gt; 10                     plos medicin        9     0 2012-04-17T00:00:00Z
#&gt;    score
#&gt; 1      1
#&gt; 2      1
#&gt; 3      1
#&gt; 4      1
#&gt; 5      1
#&gt; 6      1
#&gt; 7      1
#&gt; 8      1
#&gt; 9      1
#&gt; 10     1
</code></pre>

<hr />

<h2 id="facet">Facet</h2>

<pre><code class="language-r">solr_facet(q='*:*', facet.field='journal', facet.query='cell,bird', base=url)
#&gt; $facet_queries
#&gt;        term value
#&gt; 1 cell,bird    17
#&gt;
#&gt; $facet_fields
#&gt; $facet_fields$journal
#&gt;                                 X1     X2
#&gt; 1                         plos one 931323
#&gt; 2                    plos genetics  40603
#&gt; 3                   plos pathogens  35497
#&gt; 4       plos computational biology  29838
#&gt; 5                     plos biology  26133
#&gt; 6 plos neglected tropical diseases  25119
#&gt; 7                    plos medicine  18514
#&gt; 8             plos clinical trials    521
#&gt; 9                     plos medicin      9
#&gt;
#&gt;
#&gt; $facet_dates
#&gt; NULL
#&gt;
#&gt; $facet_ranges
#&gt; NULL
</code></pre>

<p>Range faceting with &gt; 1 field</p>

<pre><code class="language-r">head( solr_facet(q='*:*', base=url, facet.range='alm_twitterCount', facet.range.start=5, facet.range.end=1000, facet.range.gap=10)$facet_ranges$alm_twitterCount )
#&gt;   X1    X2
#&gt; 1  5 60938
#&gt; 2 15 13668
#&gt; 3 25  6379
#&gt; 4 35  2952
#&gt; 5 45  2297
#&gt; 6 55  1497
</code></pre>

<hr />

<h2 id="highlight">Highlight</h2>

<pre><code class="language-r">solr_highlight(q='alcohol', hl.fl = 'abstract', rows=2, base = url)
#&gt; $`10.1371/journal.pmed.0040151`
#&gt; $`10.1371/journal.pmed.0040151`$abstract
#&gt; [1] &quot;Background: &lt;em&gt;Alcohol&lt;/em&gt; consumption causes an estimated 4% of the global disease burden, prompting&quot;
#&gt;
#&gt;
#&gt; $`10.1371/journal.pone.0027752`
#&gt; $`10.1371/journal.pone.0027752`$abstract
#&gt; [1] &quot;Background: The negative influences of &lt;em&gt;alcohol&lt;/em&gt; on TB management with regard to delays in seeking&quot;
</code></pre>

<hr />

<h2 id="stats">Stats</h2>

<pre><code class="language-r">solr_stats(q='ecology', stats.field='alm_twitterCount', stats.facet=c('journal','volume'), base=url)
#&gt;   min  max count missing    sum sumOfSquares     mean   stddev
#&gt; 1   0 1624 24326       0 113589     19746631 4.669448 28.10656
</code></pre>

<hr />

<h2 id="more-like-this">More like this</h2>

<p><code>solr_mlt</code> is a function to return similar documents to the ones searched for.</p>

<pre><code class="language-r">out &lt;- solr_mlt(q='title:&quot;ecology&quot; AND body:&quot;cell&quot;', mlt.fl='title', mlt.mindf=1, mlt.mintf=1, fl='counter_total_all', rows=5, base=url)
out$docs
#&gt;                             id counter_total_all
#&gt; 1 10.1371/journal.pbio.1001805             10102
#&gt; 2 10.1371/journal.pbio.0020440             16630
#&gt; 3 10.1371/journal.pone.0087217              2922
#&gt; 4 10.1371/journal.pone.0040117              2514
#&gt; 5 10.1371/journal.pone.0072525              1112
</code></pre>

<hr />

<h2 id="raw-data">Raw data?</h2>

<p>You can optionally get back raw <code>json</code> or <code>xml</code> from all functions by setting parameter <code>raw=TRUE</code>. You can then parse after the fact with <code>solr_parse</code>, or just process as you wish. For example:</p>

<pre><code class="language-r">(out &lt;- solr_highlight(q='alcohol', hl.fl = 'abstract', rows=2, base = url, raw=TRUE))
#&gt; [1] &quot;{\&quot;response\&quot;:{\&quot;numFound\&quot;:15301,\&quot;start\&quot;:0,\&quot;docs\&quot;:[{},{}]},\&quot;highlighting\&quot;:{\&quot;10.1371/journal.pmed.0040151\&quot;:{\&quot;abstract\&quot;:[\&quot;Background: &lt;em&gt;Alcohol&lt;/em&gt; consumption causes an estimated 4% of the global disease burden, prompting\&quot;]},\&quot;10.1371/journal.pone.0027752\&quot;:{\&quot;abstract\&quot;:[\&quot;Background: The negative influences of &lt;em&gt;alcohol&lt;/em&gt; on TB management with regard to delays in seeking\&quot;]}}}\n&quot;
#&gt; attr(,&quot;class&quot;)
#&gt; [1] &quot;sr_high&quot;
#&gt; attr(,&quot;wt&quot;)
#&gt; [1] &quot;json&quot;
</code></pre>

<p>Then parse</p>

<pre><code class="language-r">solr_parse(out, 'df')
#&gt;                          names
#&gt; 1 10.1371/journal.pmed.0040151
#&gt; 2 10.1371/journal.pone.0027752
#&gt;                                                                                                    abstract
#&gt; 1   Background: &lt;em&gt;Alcohol&lt;/em&gt; consumption causes an estimated 4% of the global disease burden, prompting
#&gt; 2 Background: The negative influences of &lt;em&gt;alcohol&lt;/em&gt; on TB management with regard to delays in seeking
</code></pre>

<hr />

<h2 id="verbosity">Verbosity</h2>

<p>As you have noticed, we include in each function the acutal call to the Solr endpoint made so you know exactly what was submitted to the remote or local Solr instance. You can suppress the message with <code>verbose=FALSE</code>. This message isn&rsquo;t in the CRAN version.</p>

<hr />

<h2 id="advanced-function-queries">Advanced: Function Queries</h2>

<p>Function Queries allow you to query on actual numeric fields in the SOLR database, and do addition, multiplication, etc on one or many fields to stort results. For example, here, we search on the product of counter_total_all and alm_twitterCount, using a new temporary field &ldquo;<em>val</em>&ldquo;</p>

<pre><code class="language-r">solr_search(q='_val_:&quot;product(counter_total_all,alm_twitterCount)&quot;', rows=5, fl='id,title', fq='doc_type:full', base=url)
#&gt;                             id
#&gt; 1 10.1371/journal.pmed.0020124
#&gt; 2 10.1371/journal.pone.0105948
#&gt; 3 10.1371/journal.pone.0046362
#&gt; 4 10.1371/journal.pone.0069841
#&gt; 5 10.1371/journal.pbio.1001535
#&gt;                                                                                                title
#&gt; 1                                                     Why Most Published Research Findings Are False
#&gt; 2 Sliding Rocks on Racetrack Playa, Death Valley National Park: First Observation of Rocks in Motion
#&gt; 3 The Power of Kawaii: Viewing Cute Images Promotes a Careful Behavior and Narrows Attentional Focus
#&gt; 4                            Facebook Use Predicts Declines in Subjective Well-Being in Young Adults
#&gt; 5                                                     An Introduction to Social Media for Scientists
</code></pre>

<p>Here, we search for the papers with the most citations</p>

<pre><code class="language-r">solr_search(q='_val_:&quot;max(counter_total_all)&quot;', rows=5, fl='id,counter_total_all', fq='doc_type:full', base=url)
#&gt;                             id counter_total_all
#&gt; 1 10.1371/journal.pmed.0020124           1002083
#&gt; 2 10.1371/journal.pmed.0050045            324559
#&gt; 3 10.1371/journal.pone.0007595            315117
#&gt; 4 10.1371/journal.pone.0033288            305965
#&gt; 5 10.1371/journal.pone.0069841            277609
</code></pre>

<p>Or with the most tweets</p>

<pre><code class="language-r">solr_search(q='_val_:&quot;max(alm_twitterCount)&quot;', rows=5, fl='id,alm_twitterCount', fq='doc_type:full', base=url)
#&gt;                             id alm_twitterCount
#&gt; 1 10.1371/journal.pone.0061981             2298
#&gt; 2 10.1371/journal.pmed.0020124             1700
#&gt; 3 10.1371/journal.pbio.1001535             1624
#&gt; 4 10.1371/journal.pone.0046362             1368
#&gt; 5 10.1371/journal.pmed.1001747             1361
</code></pre>

<hr />

<h2 id="further-reading-on-solr">Further reading on Solr</h2>

<ul>
<li><a href="http://lucene.apache.org/solr/">Solr home page</a></li>
<li><a href="http://wiki.apache.org/solr/HighlightingParameters">Highlighting help</a></li>
<li><a href="http://wiki.apache.org/solr/SimpleFacetParameters">Faceting help</a></li>
<li><a href="http://wiki.apache.org/solr/StatsComponent">Solr stats</a></li>
<li><a href="http://wiki.apache.org/solr/MoreLikeThis">&lsquo;More like this&rsquo; searches</a></li>
<li><a href="http://wiki.apache.org/solr/FieldCollapsing">Grouping/Feild collapsing</a></li>
<li><a href="http://ramlev.dk/blog/2012/06/02/install-apache-solr-on-your-mac/">Installing Solr on Mac using homebrew</a></li>
<li><a href="http://risnandar.wordpress.com/2013/09/08/how-to-install-and-setup-apache-lucene-solr-in-osx/">Install and Setup SOLR in OSX, including running Solr</a></li>
</ul>

            </div>
            <br>
            <div class="col-offset-2 col-8 top-4 labels">
                
                    <a href="/tags/r"><span class="label">R</span></a>
                
                    <a href="/tags/textmining"><span class="label">textmining</span></a>
                
                    <a href="/tags/api"><span class="label">API</span></a>
                
            </div>

            
            
            <div class="col-offset-2 col-8 top-4">
              <div id="disqus_thread"></div>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                var disqus_shortname = 'ropenscience';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



