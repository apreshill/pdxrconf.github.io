<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | Accessing iNaturalist data</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article>
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h2 style="text-align: center;">Accessing iNaturalist data</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        
                          <a href="/about/#team"> Ted Hart </a>&nbsp;
                        
                    
                </p>
                <br>
                <div style="font-size: 20px; color: #2C3E50; margin-top: 15px;">March 26, 2014</div>
            </div>
            <div class="col-offset-2 col-8 top-2">

                

                <p>The <a href="http://www.inaturalist.org/">iNaturalist</a> project is a really cool way to both engage people in citizen science and collect species occurrence data.  The premise is pretty simple, users download an app for their smartphone, and then can easily geo reference any specimen they see, uploading it to the iNaturalist website.  It let&rsquo;s users turn casual observations into meaningful crowdsourced species occurrence data. They also provide a nice robust API to access almost all of their data.  We&rsquo;ve developed a package <a href="https://github.com/ropensci/rinat"><code>rinat</code></a> that can easily access all of that data in R.  Our package <a href="https://github.com/ropensci/spocc"><code>spocc</code></a> uses iNaturalist data as one of it&rsquo;s sources, <code>rinat</code> provides an interface for all the features available in the API.</p>

<p><em>Searching</em>
Currently you can get access to iNaturalist occurrence records from our package <code>spocc</code>, which works great for scenarios where you want lot&rsquo;s of data from many sources, but <code>rinat</code> will get you full details on every record and offers other searching on terms other than species names. First let&rsquo;s see how this matches with what you can get with <code>spocc</code>.</p>

<pre><code class="language-r">options(stringsAsFactors = F)
library(spocc)
</code></pre>

<pre><code>## Loading required package: ggplot2
</code></pre>

<pre><code class="language-r">library(rinat)
out &lt;- occ(query = &quot;Accipiter striatus&quot;, from = &quot;inat&quot;)
inat_out &lt;- get_inat_obs(taxon = &quot;Accipiter striatus&quot;, maxresults = 25)
### Compare Id's and see that results are the same without viewing full tables
cbind(out$inat$data$Accipiter_striatus$Id[1:5], inat_out$Id[1:5])
</code></pre>

<pre><code>##        [,1]   [,2]
## [1,] 581369 581369
## [2,] 574433 574433
## [3,] 570635 570635
## [4,] 555214 555214
## [5,] 551405 551405
</code></pre>

<p>The results are the same, the <code>rinat</code> package will offer a bit more flexiblity in searching.  You can search for records by a fuzzy search query, a taxon (used above in <code>spocc</code>), a location in a bounding box, or by date.  Let&rsquo;s say you just want to search by for records of Mayflies, you can use the taxon parameter to search for all lower level taxonomic matches below order.</p>

<pre><code class="language-r">may_flies &lt;- get_inat_obs(taxon = &quot;Ephemeroptera&quot;)
## See what species names come back.
may_flies$Species.guess[1:10]
</code></pre>

<pre><code>##  [1] &quot;Mayfly&quot;               &quot;Heptageniidae&quot;        &quot;Ephemerella subvaria&quot;
##  [4] &quot;Ephemerella subvaria&quot; &quot;Mayflies&quot;             &quot;Stream Mayflies&quot;
##  [7] &quot;Mayflies&quot;             &quot;Mayflies&quot;             &quot;Mayflies&quot;
## [10] &quot;Hexagenia&quot;
</code></pre>

<p>You could also search using the fuzzy query parameter, looking for mentions of a specific habitat or a common name. Below I&rsquo;ll search for one of my favorite habitats, vernal ponds and see what species come back.  Also we can search for common names and see the scientific names (which should be all the same).</p>

<pre><code class="language-r">vp_obs &lt;- get_inat_obs(query = &quot;vernal pool&quot;)
vp_obs$Species.guess[1:10]
</code></pre>

<pre><code>##  [1] &quot;Docks (Genus Rumex)&quot;
##  [2] &quot;Blennosperma bakeri&quot;
##  [3] &quot;Rails, Gallinules, and Coots&quot;
##  [4] &quot;Western Spadefoot&quot;
##  [5] &quot;Western Spadefoot&quot;
##  [6] &quot;Eupsilia&quot;
##  [7] &quot;upland chorus frog&quot;
##  [8] &quot;Wood Frog&quot;
##  [9] &quot;Striped Meadowhawk (Sympetrum pallipes)&quot;
## [10] &quot;Ambystoma maculatum&quot;
</code></pre>

<pre><code class="language-r">
# Now le'ts look up by common name:

deer &lt;- get_inat_obs(query = &quot;Mule Deer&quot;)
deer$Scientific.name[1:10]
</code></pre>

<pre><code>##  [1] &quot;Odocoileus hemionus&quot; &quot;Odocoileus hemionus&quot; &quot;Odocoileus hemionus&quot;
##  [4] &quot;Odocoileus hemionus&quot; &quot;Odocoileus hemionus&quot; &quot;Odocoileus hemionus&quot;
##  [7] &quot;Odocoileus hemionus&quot; &quot;Odocoileus hemionus&quot; &quot;Odocoileus&quot;
## [10] &quot;Odocoileus hemionus&quot;
</code></pre>

<p>All of these general searching functions return a dataframe that is m x 32 (where m is the requested number of results).  The column names are mostly self-explanatory, including, common names, species names, observer id&rsquo;s, observer names, data quality, licenses and url&rsquo;s for images so you can go look at the photo a user took.</p>

<p><em>Filtering</em></p>

<p>All searches can also be filtered by space and time.  You can search for records within a specific bounding box, or on a specific date (but not a range).  We can redo our deer search using a bounding box for the western United States.</p>

<pre><code class="language-r">bounds &lt;- c(38.44047, -125, 40.86652, -121.837)
deer &lt;- get_inat_obs(query = &quot;Mule Deer&quot;, bounds = bounds)
cat(paste(&quot;The number of records found in your bunding box:&quot;, dim(deer)[1],
    sep = &quot; &quot;))
</code></pre>

<pre><code>## The number of records found in your bunding box: 47
</code></pre>

<p>By checking the dimensions, we can see only 47 records were found.  We could try the samething for a given day, month or year. Let&rsquo;s try searhing for cumulative totals of observations of Ephemeroptera and see if we can detect seasonality.</p>

<pre><code class="language-r">library(ggplot2)
out &lt;- rep(NA, 12)
for (i in 1:12) {
    out[i] &lt;- dim(get_inat_obs(taxon = &quot;Ephemeroptera&quot;, month = i, maxresults = 200))[1]
}
out &lt;- data.frame(out)
out$month &lt;- factor(month.name, levels = month.name)
ggplot(out, aes(x = month, y = out, group = 1)) + geom_point() + stat_smooth(se = FALSE) +
    xlab(&quot;Month&quot;) + ylab(&quot;Cumulative of Mayfly observations&quot;) + theme_bw(16)

</code></pre>

<p><img src="/assets/blog-images/2014-03-26-rinat/filter_date.png" alt="plot of chunk filter_date" /></p>

<p>Exactly as you&rsquo;d expect observations of this season insect tend to peak in the summer and then slowly decline.  Except for September peak, it follows the expected trend.</p>

<p><em>User and project data</em></p>

<p>There are several other functions from the API that allow you to access data about projects and users. You can grab detailed data about projects, users and observations.  Let&rsquo;s look at the <a href="http://www.inaturalist.org/projects/state-flowers-of-the-united-states-eol-collection">EOL state flowers project</a>.  First we can grab some basic info on the project by searching for it based on it&rsquo;s &ldquo;slug&rdquo;.  You can find this in the URL of the project: &ldquo;<a href="http://www.inaturalist.org/projects/state-flowers-of-the-united-states-eol-collection&quot;">http://www.inaturalist.org/projects/state-flowers-of-the-united-states-eol-collection&quot;</a>, which is the section of text after &ldquo;projects/&rdquo;, so in this case it would be &ldquo;state-flowers-of-the-united-states-eol-collection&rdquo;</p>

<p>Let&rsquo;s grab some info on the project by getting observations but set the <code>type</code> as &ldquo;info&rdquo;</p>

<pre><code class="language-r">eol_flow &lt;- get_inat_obs_project(&quot;state-flowers-of-the-united-states-eol-collection&quot;,
    type = &quot;info&quot;, raw = FALSE)
</code></pre>

<pre><code>## 204  Records
## 0
</code></pre>

<pre><code class="language-r">### See how many taxa there are, and how many counts there have been
cat(paste(&quot;The project has observed this many species:&quot;, eol_flow$taxa_number,
    sep = &quot; &quot;))
</code></pre>

<pre><code>## The project has observed this many species: 20
</code></pre>

<pre><code class="language-r">cat(paste(&quot;The project has observed this many occurrences:&quot;, eol_flow$taxa_count,
    sep = &quot; &quot;))
</code></pre>

<pre><code>## The project has observed this many occurrences: 204
</code></pre>

<p>We can grab all the observations from the project as well just by setting the <code>type</code> as &ldquo;observations&rdquo;.  Then it&rsquo;s easy to to get details about specific observations or users.</p>

<pre><code class="language-r">eol_obs &lt;- get_inat_obs_project(&quot;state-flowers-of-the-united-states-eol-collection&quot;,
    type = &quot;observations&quot;, raw = FALSE)
</code></pre>

<pre><code>## 204  Records
## 0-100-200-300
</code></pre>

<pre><code class="language-r">## See just the first few details of an observation.
head(get_inat_obs_id(eol_obs$Id[1]))
</code></pre>

<pre><code>## $captive
## NULL
##
## $comments_count
## [1] 0
##
## $community_taxon_id
## [1] 48225
##
## $created_at
## [1] &quot;2013-04-08T15:49:15-07:00&quot;
##
## $delta
## [1] FALSE
##
## $description
## [1] &quot;&quot;
</code></pre>

<pre><code class="language-r">## See the first five species this user has recorded
head(get_inat_obs_user(as.character(eol_obs$User.login[1]), maxresults = 20))[,
    1]
</code></pre>

<pre><code>## [1] &quot;Lynx rufus&quot;              &quot;Melanerpes formicivorus&quot;
## [3] &quot;Lontra canadensis&quot;       &quot;Buteo lineatus&quot;
## [5] &quot;Icteridae&quot;               &quot;Pelecanus occidentalis&quot;
</code></pre>

<p>There are many more details that you can get, like counts of observations by place ID (extracted from the project or observation, but not well exposed to users), the most common species by date, or by user.  There is almost no end to the details you can extract.  If you ever wanted to do a case study of a citizen science project, you could get data to answer almost any question you had about the iNaturalist project with <code>rinat</code>.</p>

<p>Finally, what species occurrence package wouldn&rsquo;t be complete without some basic mapping.  This function will generate a quick map for you based on a data frame of observations from <code>rinat</code>. These can be from functions such as <code>get_inat_obs</code>, or <code>get_inat_obs_project</code>.  Let&rsquo;s end by plotting all the observations from the EOL state flowers project.</p>

<pre><code class="language-r">### Set plot to false so it returns a ggplot2 object, and that let's us modify
### it.
eol_map &lt;- inat_map(eol_obs, plot = FALSE)
### Now we can modify the returned map
eol_map + borders(&quot;state&quot;) + theme_bw() + xlim(-125, -65) + ylim(25, 50)

</code></pre>

<p><img src="/assets/blog-images/2014-03-26-rinat/eol_plot.png" alt="plot of chunk eol_plot" /></p>

            </div>
            <br>
            <div class="col-offset-2 col-8 top-4 labels">
                
                    <a href="/tags/r"><span class="label">R</span></a>
                
                    <a href="/tags/api"><span class="label">API</span></a>
                
                    <a href="/tags/biodiversity"><span class="label">biodiversity</span></a>
                
                    <a href="/tags/species"><span class="label">species</span></a>
                
                    <a href="/tags/occurrence"><span class="label">occurrence</span></a>
                
            </div>

            
            
            <div class="col-offset-2 col-8 top-4">
              <div id="disqus_thread"></div>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                var disqus_shortname = 'ropenscience';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



