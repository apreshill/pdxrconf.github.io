<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | Parse NOAA Integrated Surface Data Files</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article class="blog-post">
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h1 style="text-align: center;">Parse NOAA Integrated Surface Data Files</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        &nbsp;
                        
                          <a href="/about/#team">Scott Chamberlain</a> 
                        
                        
                        &nbsp; |
                    
                    <small style="color: #5B617A; margin-left: 10px;"> NOVEMBER 3, 2016</small>
                </p>
            </div>
            <div class="col-offset-2 col-8 top-2">
                

<p>A new package <a href="https://cran.rstudio.com/web/packages/isdparser">isdparser</a> is
on CRAN. <code>isdparser</code> was in part liberated from <a href="https://github.com/ropensci/rnoaa">rnoaa</a>,
then improved. We&rsquo;ll use <code>isdparser</code> in <code>rnoaa</code> soon.</p>

<p><code>isdparser</code> does not download files for you from NOAA&rsquo;s ftp servers. The
package focuses on parsing the files, which are variable length ASCII strings
stored line by line, where each line has some mandatory data, and any amount
of optional data.</p>

<p>The data is great, and includes for example, wind speed and direction, temperature,
cloud data, sea level pressure, and more. Includes data from approximately 35,000
stations worldwide, though best coverage is in North America/Europe/Australia.
Data go all the way back to 1901, and are updated daily.</p>

<p>However, <a href="ftp://ftp.ncdc.noaa.gov/pub/data/noaa/">the data</a> is not fun to parse,
warranting an packge to deal with the parsing.</p>

<h2 id="installation">Installation</h2>

<pre><code class="language-r">install.packages(&quot;isdparser&quot;)
</code></pre>

<p>If binaries aren&rsquo;t available, try from source:
<code>install.packages(&quot;isdparser&quot;, type = &quot;source&quot;)</code> or from GitHub:
<code>devtools::install_github(&quot;ropenscilabs/isdparser&quot;)</code></p>

<pre><code class="language-r">library(isdparser)
library(dplyr)
</code></pre>

<h2 id="parse-individual-lines">Parse individual lines</h2>

<p>If you want to parse individual lines, use <code>isd_parse_line()</code></p>

<p>First, let&rsquo;s get a ISD file. There&rsquo;s a few that come with the package:</p>

<pre><code class="language-r">path &lt;- system.file('extdata/024130-99999-2016.gz', package = &quot;isdparser&quot;)
</code></pre>

<p>Read in the file</p>

<pre><code class="language-r">lns &lt;- readLines(path, encoding = &quot;latin1&quot;)
</code></pre>

<p>Parse a line</p>

<pre><code class="language-r">isd_parse_line(lns[1])
#&gt; # A tibble: 1 × 42
#&gt;   total_chars usaf_station wban_station       date  time date_flag
#&gt;         &lt;dbl&gt;        &lt;chr&gt;        &lt;chr&gt;     &lt;date&gt; &lt;chr&gt;     &lt;chr&gt;
#&gt; 1          54       024130        99999 2016-01-01  0000         4
#&gt; # ... with 36 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;,
#&gt; #   type_code &lt;chr&gt;, elevation &lt;dbl&gt;, call_letter &lt;chr&gt;, quality &lt;chr&gt;,
#&gt; #   wind_direction &lt;dbl&gt;, wind_direction_quality &lt;chr&gt;, wind_code &lt;chr&gt;,
#&gt; #   wind_speed &lt;dbl&gt;, wind_speed_quality &lt;chr&gt;, ceiling_height &lt;chr&gt;,
#&gt; #   ceiling_height_quality &lt;chr&gt;, ceiling_height_determination &lt;chr&gt;,
#&gt; #   ceiling_height_cavok &lt;chr&gt;, visibility_distance &lt;chr&gt;,
#&gt; #   visibility_distance_quality &lt;chr&gt;, visibility_code &lt;chr&gt;,
#&gt; #   visibility_code_quality &lt;chr&gt;, temperature &lt;dbl&gt;,
#&gt; #   temperature_quality &lt;chr&gt;, temperature_dewpoint &lt;dbl&gt;,
#&gt; #   temperature_dewpoint_quality &lt;chr&gt;, air_pressure &lt;dbl&gt;,
#&gt; #   air_pressure_quality &lt;chr&gt;,
#&gt; #   AW1_present_weather_observation_identifier &lt;chr&gt;,
#&gt; #   AW1_automated_atmospheric_condition_code &lt;chr&gt;,
#&gt; #   AW1_quality_automated_atmospheric_condition_code &lt;chr&gt;,
#&gt; #   N03_original_observation &lt;chr&gt;, N03_original_value_text &lt;chr&gt;,
#&gt; #   N03_units_code &lt;chr&gt;, N03_parameter_code &lt;chr&gt;, REM_remarks &lt;chr&gt;,
#&gt; #   REM_identifier &lt;chr&gt;, REM_length_quantity &lt;chr&gt;, REM_comment &lt;chr&gt;
</code></pre>

<p>By default you get a tibble back, but you can ask for a list in return instead.</p>

<p>Parsing by line allows the user to decide how to apply parsing across lines,
whether it be <code>lapply</code> style, or for loop, etc.</p>

<h2 id="parse-entire-files">Parse entire files</h2>

<p>You can also parse entire ISD files.</p>

<pre><code class="language-r">isd_parse(path)
#&gt; # A tibble: 2,601 × 42
#&gt;    total_chars usaf_station wban_station       date  time date_flag
#&gt;          &lt;dbl&gt;        &lt;chr&gt;        &lt;chr&gt;     &lt;date&gt; &lt;chr&gt;     &lt;chr&gt;
#&gt; 1           54       024130        99999 2016-01-01  0000         4
#&gt; 2           54       024130        99999 2016-01-01  0100         4
#&gt; 3           54       024130        99999 2016-01-01  0200         4
#&gt; 4           54       024130        99999 2016-01-01  0300         4
#&gt; 5           54       024130        99999 2016-01-01  0400         4
#&gt; 6           39       024130        99999 2016-01-01  0500         4
#&gt; 7           54       024130        99999 2016-01-01  0600         4
#&gt; 8           39       024130        99999 2016-01-01  0700         4
#&gt; 9           54       024130        99999 2016-01-01  0800         4
#&gt; 10          54       024130        99999 2016-01-01  0900         4
#&gt; # ... with 2,591 more rows, and 36 more variables: latitude &lt;dbl&gt;,
#&gt; #   longitude &lt;dbl&gt;, type_code &lt;chr&gt;, elevation &lt;dbl&gt;, call_letter &lt;chr&gt;,
#&gt; #   quality &lt;chr&gt;, wind_direction &lt;dbl&gt;, wind_direction_quality &lt;chr&gt;,
#&gt; #   wind_code &lt;chr&gt;, wind_speed &lt;dbl&gt;, wind_speed_quality &lt;chr&gt;,
#&gt; #   ceiling_height &lt;chr&gt;, ceiling_height_quality &lt;chr&gt;,
#&gt; #   ceiling_height_determination &lt;chr&gt;, ceiling_height_cavok &lt;chr&gt;,
#&gt; #   visibility_distance &lt;chr&gt;, visibility_distance_quality &lt;chr&gt;,
#&gt; #   visibility_code &lt;chr&gt;, visibility_code_quality &lt;chr&gt;,
#&gt; #   temperature &lt;dbl&gt;, temperature_quality &lt;chr&gt;,
#&gt; #   temperature_dewpoint &lt;dbl&gt;, temperature_dewpoint_quality &lt;chr&gt;,
#&gt; #   air_pressure &lt;dbl&gt;, air_pressure_quality &lt;chr&gt;,
#&gt; #   AW1_present_weather_observation_identifier &lt;chr&gt;,
#&gt; #   AW1_automated_atmospheric_condition_code &lt;chr&gt;,
#&gt; #   AW1_quality_automated_atmospheric_condition_code &lt;chr&gt;,
#&gt; #   N03_original_observation &lt;chr&gt;, N03_original_value_text &lt;chr&gt;,
#&gt; #   N03_units_code &lt;chr&gt;, N03_parameter_code &lt;chr&gt;, REM_remarks &lt;chr&gt;,
#&gt; #   REM_identifier &lt;chr&gt;, REM_length_quantity &lt;chr&gt;, REM_comment &lt;chr&gt;
</code></pre>

<p>Optionally, you can print progress:</p>

<pre><code class="language-r">isd_parse(path, progress = TRUE)
#&gt; # A tibble: 2,601 × 42
#&gt;    total_chars usaf_station wban_station       date  time date_flag
#&gt;          &lt;dbl&gt;        &lt;chr&gt;        &lt;chr&gt;     &lt;date&gt; &lt;chr&gt;     &lt;chr&gt;
#&gt; 1           54       024130        99999 2016-01-01  0000         4
#&gt; 2           54       024130        99999 2016-01-01  0100         4
#&gt; 3           54       024130        99999 2016-01-01  0200         4
#&gt; 4           54       024130        99999 2016-01-01  0300         4
#&gt; 5           54       024130        99999 2016-01-01  0400         4
#&gt; 6           39       024130        99999 2016-01-01  0500         4
#&gt; 7           54       024130        99999 2016-01-01  0600         4
#&gt; 8           39       024130        99999 2016-01-01  0700         4
#&gt; 9           54       024130        99999 2016-01-01  0800         4
#&gt; 10          54       024130        99999 2016-01-01  0900         4
#&gt; # ... with 2,591 more rows, and 36 more variables: latitude &lt;dbl&gt;,
#&gt; #   longitude &lt;dbl&gt;, type_code &lt;chr&gt;, elevation &lt;dbl&gt;, call_letter &lt;chr&gt;,
#&gt; #   quality &lt;chr&gt;, wind_direction &lt;dbl&gt;, wind_direction_quality &lt;chr&gt;,
#&gt; #   wind_code &lt;chr&gt;, wind_speed &lt;dbl&gt;, wind_speed_quality &lt;chr&gt;,
#&gt; #   ceiling_height &lt;chr&gt;, ceiling_height_quality &lt;chr&gt;,
#&gt; #   ceiling_height_determination &lt;chr&gt;, ceiling_height_cavok &lt;chr&gt;,
#&gt; #   visibility_distance &lt;chr&gt;, visibility_distance_quality &lt;chr&gt;,
#&gt; #   visibility_code &lt;chr&gt;, visibility_code_quality &lt;chr&gt;,
#&gt; #   temperature &lt;dbl&gt;, temperature_quality &lt;chr&gt;,
#&gt; #   temperature_dewpoint &lt;dbl&gt;, temperature_dewpoint_quality &lt;chr&gt;,
#&gt; #   air_pressure &lt;dbl&gt;, air_pressure_quality &lt;chr&gt;,
#&gt; #   AW1_present_weather_observation_identifier &lt;chr&gt;,
#&gt; #   AW1_automated_atmospheric_condition_code &lt;chr&gt;,
#&gt; #   AW1_quality_automated_atmospheric_condition_code &lt;chr&gt;,
#&gt; #   N03_original_observation &lt;chr&gt;, N03_original_value_text &lt;chr&gt;,
#&gt; #   N03_units_code &lt;chr&gt;, N03_parameter_code &lt;chr&gt;, REM_remarks &lt;chr&gt;,
#&gt; #   REM_identifier &lt;chr&gt;, REM_length_quantity &lt;chr&gt;, REM_comment &lt;chr&gt;
</code></pre>

<p>There&rsquo;s a parallel option as well, coming in handy with the larger ISD files:</p>

<pre><code class="language-r">isd_parse(path, parallel = TRUE)
</code></pre>

<h2 id="visualize-the-data">Visualize the data</h2>

<p>Make better date + time</p>

<pre><code class="language-r">df &lt;- res %&gt;%
  rowwise() %&gt;%
  mutate(
    datetime = as.POSIXct(strptime(paste(date, paste0(substring(time, 1, 2), &quot;:00:00&quot;)), &quot;%Y-%m-%d %H:%M:%S&quot;))
  ) %&gt;%
  ungroup
</code></pre>

<p>viz</p>

<pre><code class="language-r"># removing some outliers (obs, look into more for serious use)
library(ggplot2)
ggplot(df[df$temperature &lt; 100,], aes(datetime, temperature)) +
  geom_point() +
  theme_grey(base_size = 18)
</code></pre>

<p><img src="/assets/blog-images/2016-11-03-isdparser-release/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<h2 id="future-work">Future work</h2>

<p>I plan to improve performance via profiling and swapping out slower code for faster,
as well as possibly dropping down to C++.</p>

<p>There was already a featur request for asking for fields of interest instead of
getting all fields, so <a href="https://github.com/ropenscilabs/isdparser/issues/8">that&rsquo;s on the list</a>.</p>

<p>Do try out <code>isdparser</code>. Let us know of any bugs, and any feature requests!</p>

            </div>
            <br>


            
            
            <div class="col-offset-2 col-8 top-4">
              <div id="disqus_thread"></div>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                var disqus_shortname = 'ropenscience';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



