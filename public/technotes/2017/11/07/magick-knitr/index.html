<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | Using Magick with RMarkdown and Shiny</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article class="blog-post">
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h1 style="text-align: center;">Using Magick with RMarkdown and Shiny</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        &nbsp;
                        
                          <a href="/about/#team">Jeroen Ooms</a>
                        
                        
                        &nbsp; |
                    
                    <small style="color: #5B617A; margin-left: 10px;"> NOVEMBER 7, 2017</small>
                </p>
            </div>
            <div class="col-offset-2 col-8 top-2">
                

<p>This week <a href="https://cran.r-project.org/web/packages/magick/vignettes/intro.html">magick</a> 1.5 appeared on CRAN. The latest update adds support for using images in knitr documents and shiny apps. In this post we show how this nicely ties together a reproducible image workflow in R, from source image or plot directly into your report or application.</p>

<pre><code class="language-r">library(magick)
stopifnot(packageVersion('magick') &gt;= 1.5)
</code></pre>

<p>Also the magick <a href="https://cran.r-project.org/web/packages/magick/vignettes/intro.html">intro vignette</a> has been updated in this version to cover the latest features available in the package.</p>

<h2 id="magick-in-knitr-rmarkdown-documents">Magick in Knitr / RMarkdown Documents</h2>

<p>Magick 1.5 is now fully compatible with knitr. To embed magick images in your rmarkdown report, simply use standard code chunk syntax in your <code>Rmd</code> file. No special options or packages are required; the image automatically appears in your documents when printed!</p>

<pre><code class="language-r"># Example from our post last week
image_read('logo:') %&gt;%
  image_convolve('DoG:0,0,2') %&gt;%
  image_negate() %&gt;%
  image_resize(&quot;400x400&quot;)
</code></pre>

<p><img src="https://i.imgur.com/PhwCJ4k.gif" alt="fig1" /></p>

<p>You can also combine this with the magick graphics device to post process or animate your plots and figures directly in knitr. Again no special packages or system dependencies are required.</p>

<pre><code class="language-r"># Produce graphic
fig &lt;- image_graph(width = 800, height = 600, res = 96)
ggplot2::qplot(factor(cyl), data = mtcars, fill = factor(gear))
invisible(dev.off())

print(fig)
</code></pre>

<p><img src="https://i.imgur.com/zFLcHws.png" alt="fig2" /></p>

<pre><code class="language-r">
# Some post-processing
frink &lt;- image_read(&quot;https://jeroen.github.io/images/frink.png&quot;)

fig %&gt;%
  image_rotate(10) %&gt;%
  image_implode(.6) %&gt;%
  image_composite(frink, offset = &quot;+140+70&quot;) %&gt;%
  image_annotate(&quot;Very usefull stuff&quot;, size = 40, location = &quot;+300+100&quot;, color = &quot;navy&quot;, boxcolor = &quot;pink&quot;)
</code></pre>

<p><img src="https://i.imgur.com/0E5cqaz.png" alt="fig3" /></p>

<p>Same works for animation with <code>image_animate()</code>; the figure shows automatically up in the report as a gif image:</p>

<pre><code class="language-r">image_read(&quot;https://jeroen.github.io/images/banana.gif&quot;) %&gt;%
  image_apply( function(banana){
    image_composite(fig, banana, offset = &quot;+200+200&quot;)
  }) %&gt;%
  image_resize(&quot;50%&quot;) %&gt;%
  image_animate()
</code></pre>

<p><img src="https://i.imgur.com/mi67gjt.gif" alt="fig4" /></p>

<p>The magick vignette <a href="https://raw.githubusercontent.com/ropensci/magick/master/vignettes/intro.Rmd">source code</a> is itself written in Rmarkdown, so it&rsquo;s great example to see this in action. Try rendering it in RStudio to see how easy it is!</p>

<h2 id="magick-in-shiny-apps">Magick in Shiny Apps</h2>

<p>While we&rsquo;re at it, several people had asked how to use magick images in shiny apps. The easiest way is to write the image to a <code>tempfile()</code> within the <code>renderImage()</code> callback function. For example the server part could look like this:</p>

<pre><code class="language-r">output$img &lt;- renderImage({
    tmpfile &lt;- image %&gt;%
      image_resize(input$size) %&gt;%
      image_implode(input$implode) %&gt;%
      image_blur(input$blur, input$blur) %&gt;%
      image_rotate(input$rotation) %&gt;%
      image_write(tempfile(fileext='jpg'), format = 'jpg')

  # Return a list
  list(src = tmpfile, contentType = &quot;image/jpeg&quot;)
})
</code></pre>

<p>Below is a simple shiny app that demonstrates this. Have a look at the <a href="https://github.com/jeroen/shinymagick/blob/master/app.R">source code</a> or just run it in R:</p>

<pre><code class="language-r">library(shiny)
library(magick)
runGitHub(&quot;jeroen/shinymagick&quot;)
</code></pre>

<p><a href="https://jeroen.shinyapps.io/shinymagick"><img src="https://i.imgur.com/tTFk7ig.jpg" alt="tigrou" /></a></p>

<p>Perhaps there&rsquo;s an even better way to make this work by wrapping magick images into an htmlwidget but I have not figured this out yet.</p>

            </div>
            <br>


            
            
            <div class="col-offset-2 col-8 top-4">
                <div id='discourse-comments'></div>
                <script type="text/javascript">
                DiscourseEmbed = { discourseUrl: 'https://discuss.ropensci.org/',
                                   topicId:  947  };
                (function() {
                  var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
                  d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
                })();
                </script>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



