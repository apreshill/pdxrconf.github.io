<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | solrium 1.0: Working with Solr from R</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-462421-6', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>


<article class="blog-post">
    <div class="container">
        <div class="row">
            <div class="col-2 sidebar top-5">
                <ul class="autoSidebar"></ul>
            </div> 
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-20">
                <h1 style="text-align: center;">solrium 1.0: Working with Solr from R</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-offset-2 col-8 top-10 bottom-5" style="font-size: 20px; text-align: center;">
                <p class="authors" style="text-align: center;">
                    
                        &nbsp;
                        
                          <a href="/about/#team">Scott Chamberlain</a> 
                        
                        
                        &nbsp; |
                    
                    <small style="color: #5B617A; margin-left: 10px;"> NOVEMBER 8, 2017</small>
                </p>
            </div>
            <div class="col-offset-2 col-8 top-2">
                

<p>Nearly 4 years ago I wrote on this blog about an R package <a href="https://github.com/ropensci/solr">solr</a> for working with the database <a href="https://lucene.apache.org/solr/">Solr</a>. Since then we&rsquo;ve created a refresh of that package in the <a href="https://github.com/ropensci/solrium">solrium</a> package. Since <code>solrium</code> first hit CRAN about two years ago, users have raised a number of issues that required breaking changes. Thus, this blog post is about a major version bump in <code>solrium</code>.</p>

<p><br></p>

<h2 id="what-is-solr">What is Solr?</h2>

<p>Solr is a &ldquo;search platform&rdquo; - a NoSQL database - data is organized by so called documents that are xml/json/etc blobs of text. Documents are nested within either collections or cores (depending on the mode you start Solr in). Solr makes it easy to search for documents, with a huge variety of parameters, and a number of different data formats (json/xml/csv). Solr is similar to <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> (see our Elasticsearch client <a href="https://github.com/ropensci/elastic">elastic</a>) - and was around before it. Solr in my opinion is harder to setup than Elasticsearch, but I don&rsquo;t claim to be an expert on either.</p>

<p><br></p>

<h2 id="vignettes">Vignettes</h2>

<ul>
<li><a href="https://cran.rstudio.com/web/packages/solrium/vignettes/search.html">Solr Search with solrium</a></li>
<li><a href="https://cran.rstudio.com/web/packages/solrium/vignettes/local_setup.html">Local Solr setup</a></li>
<li><a href="https://cran.rstudio.com/web/packages/solrium/vignettes/document_management.html">Document management</a></li>
<li><a href="https://cran.rstudio.com/web/packages/solrium/vignettes/cores_collections.html">Cores/collections management</a></li>
</ul>

<h2 id="noteable-features">Noteable features</h2>

<ul>
<li>Added in v1, you can now work with many connection objects to different Solr instances.</li>
<li>Methods for the major search functionalities: search, highlight, stats, mlt, group, and facet. In addition, a catch all function <code>all</code> to combine all of those.</li>
<li>Comprehensive coverage of the Solr HTTP API</li>
<li>Can coerce data from Solr API into data.frame&rsquo;s when possible</li>
</ul>

<h2 id="setup">Setup</h2>

<p>Install <code>solrium</code></p>

<pre><code class="language-r">install.packages(&quot;solrium&quot;)
</code></pre>

<p>Or get the development version:</p>

<pre><code class="language-r">devtools::install_github(&quot;ropensci/solrium&quot;)
</code></pre>

<pre><code class="language-r">library(solrium)
</code></pre>

<p><br></p>

<h2 id="initialize-a-client">Initialize a client</h2>

<p>A big change in <code>v1</code> of <code>solrium</code> is <code>solr_connect</code> has been replaced by <code>SolrClient</code>. Now you create an <code>R6</code> connection object with <code>SolrClient</code>, then you can call methods on that <code>R6</code> object, <strong>OR</strong> you can pass the connection object to functions.</p>

<p>By default, <code>SolrClient$new()</code> sets connections details for a Solr instance that&rsquo;s running on <code>localhost</code>, and on port <code>8983</code>.</p>

<pre><code class="language-r">(conn &lt;- SolrClient$new())
</code></pre>

<pre><code>#&gt; &lt;Solr Client&gt;
#&gt;   host: 127.0.0.1
#&gt;   path: 
#&gt;   port: 8983
#&gt;   scheme: http
#&gt;   errors: simple
#&gt;   proxy:
</code></pre>

<p>On instantiation, it does not check that the Solr instance is up, but merely sets connection details. You can check if the instance is up by doing for example (assuming you have a collection named <code>gettingstarted</code>):</p>

<pre><code class="language-r">conn$ping(&quot;gettingstarted&quot;)
</code></pre>

<pre><code>#&gt; $responseHeader
#&gt; $responseHeader$zkConnected
#&gt; [1] TRUE
#&gt; 
#&gt; $responseHeader$status
#&gt; [1] 0
#&gt; 
#&gt; $responseHeader$QTime
#&gt; [1] 163
#&gt; 
#&gt; $responseHeader$params
#&gt; $responseHeader$params$q
#&gt; [1] &quot;{!lucene}*:*&quot;
#&gt; 
#&gt; $responseHeader$params$distrib
#&gt; [1] &quot;false&quot;
#&gt; 
#&gt; $responseHeader$params$df
#&gt; [1] &quot;_text_&quot;
#&gt; 
#&gt; $responseHeader$params$rows
#&gt; [1] &quot;10&quot;
#&gt; 
#&gt; $responseHeader$params$wt
#&gt; [1] &quot;json&quot;
#&gt; 
#&gt; $responseHeader$params$echoParams
#&gt; [1] &quot;all&quot;
#&gt; 
#&gt; 
#&gt; 
#&gt; $status
#&gt; [1] &quot;OK&quot;
</code></pre>

<p>A good hint when connecting to a publicly exposed Solr instance is that you likely don&rsquo;t need to specify a port, so a pattern like this should work to connect to a URL like <code>http://foobar.com/search</code>:</p>

<pre><code class="language-r">SolrClient$new(host = &quot;foobar.com&quot;, path = &quot;search&quot;, port = NULL)
</code></pre>

<p>If the instance uses SSL, simply specify that like:</p>

<pre><code class="language-r">SolrClient$new(host = &quot;foobar.com&quot;, path = &quot;search&quot;, port = NULL, scheme = &quot;https&quot;)
</code></pre>

<p><br></p>

<h2 id="query-and-body-parameters">Query and body parameters</h2>

<p>Another big change in the package is that we wanted to make it easy to determine whether your Solr query gets passed as query parameters in a <code>GET</code> request or as body in a <code>POST</code> request. Solr clients in some other languages do this, and it made sense to port over that idea here. Now you pass your key-value pairs to either <code>params</code> or <code>body</code>. If nothing is passed to <code>body</code>, we do a <code>GET</code> request. If something is passed to <code>body</code> we do a <code>POST</code> request, even if there&rsquo;s also key-value pairs passed to <code>params</code>.</p>

<p>This change does break the interface we had in the old version, but we think it&rsquo;s worth it.</p>

<p>For example, to do a search you have to pass the collection name and a list of named parameters:</p>

<pre><code class="language-r">conn$search(name = &quot;gettingstarted&quot;, params = list(q = &quot;*:*&quot;))
</code></pre>

<pre><code>#&gt; # A tibble: 5 x 5
#&gt;      id   title title_str  `_version_` price
#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt; &lt;int&gt;
#&gt; 1    10 adfadsf   adfadsf 1.582913e+18    NA
#&gt; 2    12  though    though 1.582913e+18    NA
#&gt; 3    14 animals   animals 1.582913e+18    NA
#&gt; 4     1    &lt;NA&gt;      &lt;NA&gt; 1.582913e+18   100
#&gt; 5     2    &lt;NA&gt;      &lt;NA&gt; 1.582913e+18   500
</code></pre>

<p>You can instead pass the connection object to <code>solr_search</code>:</p>

<pre><code class="language-r">solr_search(conn, name = &quot;gettingstarted&quot;, params = list(q = &quot;*:*&quot;))
</code></pre>

<pre><code>#&gt; # A tibble: 5 x 5
#&gt;      id   title title_str  `_version_` price
#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt; &lt;int&gt;
#&gt; 1    10 adfadsf   adfadsf 1.582913e+18    NA
#&gt; 2    12  though    though 1.582913e+18    NA
#&gt; 3    14 animals   animals 1.582913e+18    NA
#&gt; 4     1    &lt;NA&gt;      &lt;NA&gt; 1.582913e+18   100
#&gt; 5     2    &lt;NA&gt;      &lt;NA&gt; 1.582913e+18   500
</code></pre>

<p>And the same pattern applies for the other functions:</p>

<ul>
<li><code>solr_facet</code></li>
<li><code>solr_group</code></li>
<li><code>solr_mlt</code></li>
<li><code>solr_highlight</code></li>
<li><code>solr_stats</code></li>
<li><code>solr_all</code></li>
</ul>

<p><br></p>

<h2 id="new-functions-for-atomic-updates">New functions for atomic updates</h2>

<p><a href="https://github.com/ropensci/solrium/issues/97">A user requested</a> the ability to do <a href="https://lucene.apache.org/solr/guide/7_0/updating-parts-of-documents.html">atomic updates</a> - partial updates to documents without having to re-index the entire document.</p>

<p>Two functions were added: <code>update_atomic_json</code> and <code>update_atomic_xml</code> for JSON and XML based updates. Check out their help pages for usage.</p>

<p><br></p>

<h2 id="search-results-as-attributes">Search results as attributes</h2>

<p><code>solr_search</code> and <code>solr_all</code> in <code>v1</code> gain attributes that include <code>numFound</code>, <code>start</code>, and <code>maxScore</code>. That is, you can get to these three values after data is returned. Note that some Solr instances may not return all three values.</p>

<p>For example, let&rsquo;s use the Public Library of Science Solr search instance at <a href="http://api.plos.org/search">http://api.plos.org/search</a>:</p>

<pre><code class="language-r">plos &lt;- SolrClient$new(host = &quot;api.plos.org&quot;, path = &quot;search&quot;, port = NULL)
</code></pre>

<p>Search</p>

<pre><code class="language-r">res &lt;- plos$search(params = list(q = &quot;*:*&quot;))
</code></pre>

<p>Get attributes</p>

<pre><code class="language-r">attr(res, &quot;numFound&quot;)
#&gt; [1] 1902279
attr(res, &quot;start&quot;)
#&gt; [1] 0
attr(res, &quot;maxScore&quot;)
#&gt; [1] 1
</code></pre>

<p><br></p>

<h2 id="automatically-adjust-rows-parameter">Automatically adjust rows parameter</h2>

<p><a href="https://github.com/ropensci/solrium/pull/102">A user higlighted</a> that <a href="https://wiki.apache.org/solr/SolrPerformanceProblems#Asking_for_too_many_rows">there&rsquo;s a performance penalty when asking for too many rows</a>. The resulting change in <code>solrium</code> is that in some search functions we automatically adjust the <code>rows</code> parameter to avoid the performance penalty.</p>

<p><br></p>

<h2 id="usage-in-other-packages">Usage in other packages</h2>

<p>I maintain 4 other packages that use <code>solrium</code>: <a href="https://github.com/ropensci/rplos">rplos</a>, <a href="https://github.com/ropensci/ritis">ritis</a>, <a href="https://github.com/ropensci/rdatacite">rdatacite</a>, and <a href="https://github.com/ropensci/rdryad">rdryad</a>. If you are interested in using <code>solrium</code> in your package, looking at any of those four packages will give a good sense of how to do it.</p>

<p><br></p>

<h2 id="notes">Notes</h2>

<h3 id="solr-pkg">solr pkg</h3>

<p>The <code>solr</code> package will soon be archived on CRAN. We&rsquo;ve moved all packages depending on it to <code>solrium</code>. Let me know ASAP if you have any complaints about archiving it on CRAN.</p>

<h3 id="feedback">Feedback!</h3>

<p>Please do upgrade/install <code>solrium</code>  <code>v1</code> and let us know what you think.</p>

<p><br></p>

            </div>
            <br>


            
            
            <div class="col-offset-2 col-8 top-4">
                <div id='discourse-comments'></div>
                <script type="text/javascript">
                DiscourseEmbed = { discourseUrl: 'https://discuss.ropensci.org/',
                                   topicId:  953  };
                (function() {
                  var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
                  d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
                })();
                </script>
            </div>
            
        </div>
        <br>
    </div>
</article>





    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>



