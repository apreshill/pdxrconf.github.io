<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | Match tables with different taxon names</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>



    <article>
        <div class="container top-20">
            <div class="row centered">

                
                <div class="col-7 bottom-20 maintext">
                    <h1>Match tables with different taxon names</h1>
                    <br>
                    <h4><small style="color:grey">rOpenSci package: <a href="https://github.com/ropensci/taxize">taxize</a></small></h4>
                    <br><br>
                    <article>
                    

<p>A common situation when a set of species is having more than one table
of data, each with taxonomic names. These tables need to be merged at
some point.</p>

<p>The problem is that some of the names in the separate tables may
actually be the same, but one table may have updated names while the
other may have old names. Therefore, when merging, two rows of data that
should be matched are not.</p>

<p>We can easily take care of this problem using taxize.</p>

<h3 id="install-taxize-from-cran">Install taxize from CRAN</h3>

<pre><code class="language-r">install.packages(&quot;taxize&quot;)
</code></pre>

<h3 id="load-taxize">Load taxize</h3>

<pre><code class="language-r">library(&quot;taxize&quot;)
</code></pre>

<h3 id="table-1">Table 1</h3>

<pre><code class="language-r">df1 &lt;- data.frame(species = c(&quot;Helianthus annuus&quot;, &quot;Silene acaulis&quot;, &quot;Mimulus alpinus&quot;,&quot;Phlox drummondii&quot;, &quot;Triteleia hyacinthina&quot;), var1 = rnorm(5), var2 = rnorm(5),stringsAsFactors = FALSE)
</code></pre>

<h3 id="table-2">Table 2</h3>

<pre><code class="language-r">df2 &lt;- data.frame(species = c(&quot;Helianthus annuus texanus&quot;, &quot;Cucubalus acaulis&quot;,&quot;Mimulus langsdorffii alpinus&quot;, &quot;Armeria drummondii&quot;, &quot;Triteleia hyocinthina&quot;),var3 = rnorm(5), var4 = rnorm(5), stringsAsFactors = FALSE)
</code></pre>

<p>Take a look.</p>

<pre><code class="language-r">df1

                species    var1    var2
1     Helianthus annuus  0.7285 -0.4922
2        Silene acaulis -0.6368  0.1510
3       Mimulus alpinus  0.1223 -0.2955
4      Phlox drummondii -0.1071 -0.6371
5 Triteleia hyacinthina  3.0563  2.3601

df2

                       species    var3    var4
1    Helianthus annuus texanus  1.2547  1.5582
2            Cucubalus acaulis  0.1917 -0.4014
3 Mimulus langsdorffii alpinus -0.7310  0.3817
4           Armeria drummondii -0.8728 -1.8467
5        Triteleia hyocinthina  2.1583  0.5587
</code></pre>

<h3 id="get-the-up-to-date-accepted-names-for-both-tables">Get the up to date accepted names for both tables</h3>

<p>And add that as a new column to each table. In this example I&rsquo;m using
the <code>tpl_search</code> function which searches the Plantlist.org, but you can
use other functions for the Taxonomic Name Resolution Service (TNRS),
NCBI, EOL, and more.</p>

<pre><code class="language-r">(df1_corr &lt;- tpl_search(as.character(df1$species), corr = TRUE))

       Genus     Species Infraspecific Plant.Name.Index Taxonomic.status
1 Helianthus      annuus                           TRUE         Accepted
2     Silene     acaulis                           TRUE         Accepted
3    Mimulus     alpinus                           TRUE         Accepted
4      Phlox  drummondii                           TRUE         Accepted
5  Triteleia hyacinthina                           TRUE         Accepted
           Family  New.Genus New.Species New.Infraspecific       Authority
1      Compositae Helianthus      annuus                                L.
2 Caryophyllaceae     Silene     acaulis                        (L.) Jacq.
3      Phrymaceae    Mimulus     alpinus              &lt;NA&gt; (A. Gray) Piper
4   Polemoniaceae      Phlox  drummondii                             Hook.
5    Asparagaceae  Triteleia hyacinthina                   (Lindl.) Greene
   Typo WFormat
1 FALSE   FALSE
2 FALSE   FALSE
3 FALSE   FALSE
4 FALSE   FALSE
5 FALSE   FALSE

(df2_corr &lt;- tpl_search(as.character(df2$species), corr = TRUE))

       Genus      Species Infraspecific Plant.Name.Index Taxonomic.status
1 Helianthus       annuus       texanus             TRUE          Synonym
2  Cucubalus      acaulis                           TRUE          Synonym
3    Mimulus langsdorffii       alpinus             TRUE          Synonym
4    Armeria   drummondii                           TRUE          Synonym
5  Triteleia  hyocinthina                           TRUE         Accepted
           Family  New.Genus New.Species New.Infraspecific       Authority
1      Compositae Helianthus      annuus                                L.
2 Caryophyllaceae     Silene     acaulis                        (L.) Jacq.
3      Phrymaceae    Mimulus     alpinus              &lt;NA&gt; (A. Gray) Piper
4   Polemoniaceae      Phlox  drummondii                             Hook.
5    Asparagaceae  Triteleia hyacinthina                   (Lindl.) Greene
   Typo WFormat
1 FALSE   FALSE
2 FALSE   FALSE
3 FALSE   FALSE
4 FALSE   FALSE
5  TRUE   FALSE
</code></pre>

<p>It looks like 4 of the 5 names in df2 are synonyms, while 1 name was
misspelled. Let&rsquo;s get the new names for df2 into df2.</p>

<pre><code class="language-r">df2$newsp &lt;- apply(df2_corr[c(&quot;New.Genus&quot;, &quot;New.Species&quot;)], 1, paste, collapse = &quot; &quot;)
df2 &lt;- df2[, -1]
</code></pre>

<h3 id="merge-tables-and-make-a-plot">Merge tables and make a plot</h3>

<pre><code class="language-r">(alldat &lt;- merge(df1, df2, by.x=&quot;species&quot;, by.y=&quot;newsp&quot;))

                species    var1    var2    var3    var4
1     Helianthus annuus  0.7285 -0.4922  1.2547  1.5582
2       Mimulus alpinus  0.1223 -0.2955 -0.7310  0.3817
3      Phlox drummondii -0.1071 -0.6371 -0.8728 -1.8467
4        Silene acaulis -0.6368  0.1510  0.1917 -0.4014
5 Triteleia hyacinthina  3.0563  2.3601  2.1583  0.5587

library(&quot;ggplot2&quot;)
ggplot(alldat, aes(var1, var4)) +
  theme_grey(base_size=18) +
  geom_point() +
  labs(x=&quot;Cool variable&quot;, y=&quot;Other super sweet variable&quot;)
</code></pre>

<p><img src="/img/usecases-images/taxize_matchdfs.png" alt="" /></p>

<p>And that&rsquo;s it. Of course in practice your tables will be larger to much
larger, but the same concept applies - it will just take longer.</p>

                    </article>
                </div>

                </div>
            </div>
        </div>
    </article>


    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>
