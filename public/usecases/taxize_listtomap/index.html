<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | From a species list to cleaning names to a map of their occurrences</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>



    <article>
        <div class="container top-20">
            <div class="row centered">

                
                <div class="col-7 bottom-20 maintext">
                    <h1>From a species list to cleaning names to a map of their occurrences</h1>
                    <br>
                    <h4><small style="color:grey">rOpenSci package: <a href="https://github.com/ropensci/taxize">taxize</a></small></h4>
                    <br><br>
                    <article>
                    

<h3 id="load-libraries">Load libraries</h3>

<pre><code class="language-r">library(&quot;taxize&quot;)
</code></pre>

<p>Most of us will start out with a species list, something like the one
below. Note that each of the names is spelled incorrectly.</p>

<pre><code class="language-r">splist &lt;- c(&quot;Helanthus annuus&quot;, &quot;Pinos contorta&quot;, &quot;Collomia grandiflorra&quot;, &quot;Abies magnificaa&quot;,
    &quot;Rosa california&quot;, &quot;Datura wrighti&quot;, &quot;Mimulus bicolour&quot;, &quot;Nicotiana glauca&quot;,
    &quot;Maddia sativa&quot;, &quot;Bartlettia scapposa&quot;)
</code></pre>

<p>There are many ways to resolve taxonomic names in taxize. Of course, the
ideal name resolver will do the work behind the scenes for you so that
you don&rsquo;t have to do things like fuzzy matching. There are a few
services in taxize like this we can choose from: the Global Names
Resolver service from EOL (see function <em>gnr_resolve</em>) and the
Taxonomic Name Resolution Service from iPlant (see function <em>tnrs</em>). In
this case let&rsquo;s use the function <em>tnrs</em>.</p>

<pre><code class="language-r"># The tnrs function accepts a vector of 1 or more
splist_tnrs &lt;- tnrs(query = splist, getpost = &quot;POST&quot;, source_ = &quot;iPlant_TNRS&quot;)

## Calling http://taxosaurus.org/retrieve/bf0b4ae7f3c3c9a0d7f50854f6c0997f

# Remove some fields
(splist_tnrs &lt;- splist_tnrs[, !names(splist_tnrs) %in% c(&quot;matchedName&quot;, &quot;annotations&quot;,
    &quot;uri&quot;)])

##            submittedName         acceptedName    sourceId score
## 3       Helanthus annuus    Helianthus annuus iPlant_TNRS  0.98
## 1         Pinos contorta       Pinus contorta iPlant_TNRS  0.96
## 4  Collomia grandiflorra Collomia grandiflora iPlant_TNRS  0.99
## 5       Abies magnificaa      Abies magnifica iPlant_TNRS  0.98
## 10       Rosa california     Rosa californica iPlant_TNRS  0.99
## 9         Datura wrighti      Datura wrightii iPlant_TNRS  0.98
## 7       Mimulus bicolour      Mimulus bicolor iPlant_TNRS  0.98
## 8       Nicotiana glauca     Nicotiana glauca iPlant_TNRS     1
## 6          Maddia sativa         Madia sativa iPlant_TNRS  0.97
## 2    Bartlettia scapposa   Bartlettia scaposa iPlant_TNRS  0.98

# Note the scores. They suggest that there were no perfect matches, but
# they were all very close, ranging from 0.77 to 0.99 (1 is the highest).
# Let's assume the names in the 'acceptedName' column are correct (and
# they should be).

# So here's our updated species list
(splist &lt;- as.character(splist_tnrs$acceptedName))

##  [1] &quot;Helianthus annuus&quot;    &quot;Pinus contorta&quot;       &quot;Collomia grandiflora&quot; &quot;Abies magnifica&quot;
##  [5] &quot;Rosa californica&quot;     &quot;Datura wrightii&quot;      &quot;Mimulus bicolor&quot;      &quot;Nicotiana glauca&quot;
##  [9] &quot;Madia sativa&quot;         &quot;Bartlettia scaposa&quot;
</code></pre>

<p>Another thing we may want to do is collect common names for our taxa.</p>

<pre><code class="language-r">tsns &lt;- get_tsn(searchterm = splist, searchtype = &quot;sciname&quot;, verbose = FALSE)
comnames &lt;- lapply(tsns, getcommonnamesfromtsn)

## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=36616
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=183327
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=31037
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=181834
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=24818
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=30521
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=33245
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=30574
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=38040
## http://www.itis.gov/ITISWebService/services/ITISService/getCommonNamesFromTSN?tsn=36822

# Unfortunately, common names are not standardized like species names, so there are multiple common
# names for each taxon
sapply(comnames, length)

##  [1] 3 3 3 3 3 3 3 3 3 3

# So let's just take the first common name for each species
comnames_vec &lt;- do.call(c, lapply(comnames, function(x) as.character(x[1, &quot;comname&quot;])))

# And we can make a data.frame of our scientific and common names
(allnames &lt;- data.frame(spname = splist, comname = comnames_vec))

##                  spname                       comname
## 1     Helianthus annuus              common sunflower
## 2        Pinus contorta                lodgepole pine
## 3  Collomia grandiflora        largeflowered collomia
## 4       Abies magnifica                    golden fir
## 5      Rosa californica           California wildrose
## 6       Datura wrightii            sacred thorn-apple
## 7       Mimulus bicolor yellow and white monkeyflower
## 8      Nicotiana glauca                  tree tobacco
## 9          Madia sativa                 coast tarweed
## 10   Bartlettia scaposa                Bartlett daisy
</code></pre>

<p>Another common task is getting the taxonomic tree upstream from your
study taxa. We often know what family or order our taxa are in, but it
we often don&rsquo;t know the tribes, subclasses, and superfamilies. taxize
provides many avenues to getting classifications. Two of them are
accessible via a single function (<em>classification</em>): the Integrated
Taxonomic Information System (ITIS) and National Center for
Biotechnology Information (NCBI); and via the Catalogue of Life (see
function <em>col_classification</em>):</p>

<pre><code class="language-r"># Let's get classifications from ITIS using Taxonomic Serial Numbers. Note that we could use uBio
# instead.
class_list &lt;- classification(tsns)

## http://www.itis.gov/ITISWebService/services/ITISService/getFullHierarchyFromTSN?tsn=36616
## http://www.itis.gov/ITISWebService/services/ITISService/getFullHierarchyFromTSN?tsn=183327
## http://www.itis.gov/ITISWebService/services/ITISService/getFullHierarchyFromTSN?tsn=31037
## http://www.itis.gov/ITISWebService/services/ITISService/getFullHierarchyFromTSN?tsn=181834

## Error: Empty reply from server

# And we can attach these names to our allnames data.frame
library(&quot;plyr&quot;)
gethiernames &lt;- function(x) {
    temp &lt;- x[, c(&quot;rankName&quot;, &quot;taxonName&quot;)]
    values &lt;- data.frame(t(temp[, 2]))
    names(values) &lt;- temp[, 1]
    return(values)
}
class_df &lt;- ldply(class_list, gethiernames)

## Error: object 'class_list' not found

allnames_df &lt;- merge(allnames, class_df, by.x = &quot;spname&quot;, by.y = &quot;Species&quot;)

## Error: error in evaluating the argument 'y' in selecting a method for function 'merge': Error: object
## 'class_df' not found

# Now that we have allnames_df, we can start to see some relationships among species simply by their
# shared taxonomic names
allnames_df[1:2, ]

## Error: object 'allnames_df' not found
</code></pre>

<p>Using the species list, with the corrected names, we can now search for
occurrence data. The Global Biodiversity Information Facility (GBIF) has
the largest collection of records data, and has a API that we can
interact with programmatically from R.</p>

<pre><code class="language-r">library(&quot;rgbif&quot;)
library(&quot;ggplot2&quot;)
</code></pre>

<h3 id="get-occurences">Get occurences</h3>

<pre><code class="language-r">occurr_list &lt;- occurrencelist_many(as.character(allnames$spname), coordinatestatus = TRUE, maxresults = 100,
    fixnames = &quot;change&quot;)
</code></pre>

<h3 id="make-a-map">Make a map</h3>

<pre><code class="language-r">gbifmap_list(occurr_list) +
	guides(col = guide_legend(title = &quot;, nrow = 3, byrow = TRUE)) +
	theme(legend.position = &quot;bottom&quot;, legend.key = element_blank()) +
	coord_equal()
</code></pre>

<p><img src="/img/usecases-images/taxize_listtomap.png" alt="map" /></p>

                    </article>
                </div>

                </div>
            </div>
        </div>
    </article>


    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
</html>
