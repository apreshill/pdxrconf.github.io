<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | treebase tutorial</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>



    <article>
        <div class="container top-20">
            
            <div class="row centered">
                
                <div class="col-7 bottom-20 maintext">
                    <h1>treebase tutorial</h1>
                    <br>
                    <h4><small style="color:grey">for v0.0-7.1</small></h4>
                    <br>

                    <article>
                    

<p>Neste post vamos ilustrar a fucionalidade do pacote com alguns exemplos introdutórios. Graças em parte às novas normas de periódicos como Evolution, Am Nat, e Sys Bio que requerem que os dados sejam depositados e
planos de gerenciamento de dados requeridos pela NSF, esperamos que o pacote seja bastante útil para ensino na medida que replica os resultados ou para meta-análises que podem ser atualizadas automaticamente à medida que o repositório cresça. Informações adicionais e reletórios de erro são bem-invos via <a href="http://ropensci.org/packages/treebase.html#support">treebase page</a>.</p>

<p><section id="installation"></p>

<h2 id="instalação">Instalação</h2>

<pre><code class="language-r">install.packages('treebase')
</code></pre>

<pre><code class="language-r">library(treebase)
</code></pre>

<p><section id="usage"></p>

<h2 id="usoe">Usoe</h2>

<h1 id="busca-básica-de-dados-e-árvores">Busca básica de dados e árvores</h1>

<p>Baixando árvores usando diferentes termos: por autor, taxa, &amp; estudo. Mais opções são descritas no arquivo de ajuda.</p>

<pre><code class="language-r">both &lt;- search_treebase(&quot;Ronquist or Hulesenbeck&quot;, by=c(&quot;author&quot;, &quot;author&quot;))
dolphins &lt;- search_treebase('&quot;Delphinus&quot;', by=&quot;taxon&quot;, max_trees=5)
studies &lt;- search_treebase(&quot;2377&quot;, by=&quot;id.study&quot;)
</code></pre>

<pre><code class="language-r">Near &lt;- search_treebase(&quot;Near&quot;, &quot;author&quot;, branch_lengths=TRUE, max_trees=3)
Near[1]
</code></pre>

<pre><code>[[1]]

Phylogenetic tree with 188 tips and 186 internal nodes.

Tip labels:
	Beryx_decadactylus, Brotula_multibarbata, Odontobutis_potamophila, Percottus_glenni, Eleotris_pisonis, Cheilodipterus_quinquelineatus, ...

Unrooted; includes branch lengths.
</code></pre>

<p>Podemos fazer uma busca pelos metadados diretamente. Por exemplo, fazer um gráfico do cresciento de submissões para o Treebase em função da data da publicação</p>

<pre><code class="language-r">all &lt;- download_metadata(&quot;&quot;, by=&quot;all&quot;)
dates &lt;- sapply(all, function(x) as.numeric(x$date))
library(ggplot2)
qplot(dates, main=&quot;Treebase growth&quot;, xlab=&quot;Year&quot;, binwidth=.5)
</code></pre>

<p>(A busca anterior também aceita um conjunto de datas)</p>

<p>Como qual é ritmo de submissões semanais para o Treebase? Construímos isso de forma que nos retornará os índices dos emparelhamentos, para que possamos pegar as árvores diretamente. Rode os scripts você mesmo para ver se eles mudaram!</p>

<pre><code class="language-r">nature &lt;- sapply(all, function(x) length(grep(&quot;Nature&quot;, x$publisher))&gt;0)
science &lt;- sapply(all, function(x) length(grep(&quot;^Science$&quot;, x$publisher))&gt;0)
sum(nature)
sum(science)
</code></pre>

<h2 id="replicando-resultados">Replicando resultados</h2>

<p>Um artigo legal de Derryberry et al. sobre <a href="http://www.museum.lsu.edu/brumfield/pubs/furnphylogeny2011.pdf">diversification in ovenbirds and woodcreepers, 0.1111/j.1558-5646.2011.01374.x</a> apareceu recentemente na Evolution. O artigo menciona que a árvore está no Treebase, então vejamos se podemos replicar os resultados das análises de taxas de diversificação: Vamos pegar as árvores daqueles autores e conferir se temos as corretas:</p>

<pre><code class="language-r">search_treebase(&quot;Derryberry&quot;, &quot;author&quot;)[[1]] -&gt; tree
plot(tree)
</code></pre>

<p><img src="../assets/tutorial-images/treebase/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /></p>

<p>Eles ajustaram vários modelos de taxas de diversificação disponíveis no pacote do R <code>laser</code>, e então os compararam com AIC.</p>

<pre><code class="language-r">install.packages(&quot;laser&quot;)
</code></pre>

<pre><code class="language-r">library(laser)
tt &lt;- branching.times(tree)
models &lt;-  list(pb = pureBirth(tt),
                bdfit = bd(tt),
                y2r = yule2rate(tt), # yule model with single shift pt
                ddl = DDL(tt), # linear, diversity-dependent
                ddx = DDX(tt), #exponential diversity-dendent
                sv = fitSPVAR(tt), # vary speciation in time
                ev = fitEXVAR(tt), # vary extinction in time
                bv = fitBOTHVAR(tt)# vary both
                )
names(models[[3]])[5] &lt;- &quot;aic&quot;
aics &lt;- sapply(models, &quot;[[&quot;, &quot;aic&quot;)
# show the winning model
models[which.min(aics)]
</code></pre>

<pre><code>$y2r
         LH          r1          r2         st1         aic
 229.266990   18.316271    4.075395    0.010060 -452.533980
</code></pre>

<p>Opa! Os resultados deles concordam com as nossas análises. Ussando a grande gama de ferramenteas para analisar taxas de diversificação no R , poderíamos agora facilmente verificar se estes resultados se mantêm os mesmo quando usamos novos métodos disponívels no TreePar, etc.</p>

<h2 id="meta-analise">Meta-Analise</h2>

<p>Claro, um dos mais interessantes desafios em se ter uma interface automatizada é a possilidade de realizar meta-análises que utilizam as filogenias disponíveis no treebase. Como uma simples prova de princípios, vamos verificar todas as filogenias no treebase para ver se elas se ajustam melhor a um modelo de nascimento-morte ou Yule.</p>

<p>Criaremos duas funções simples para nos ajudar nesta análise. Enquanto essas foram fornecidas no pacote treebase, inclui-las aqui para ilustrar a flexibilidade de uma função construída (Elas são essencialmente ilustrativas; Usuários e desenvolvedores devem criar suas próprias. Numa análise mais aproprida verificaríamos alguns pontos.)</p>

<pre><code class="language-r">timetree &lt;- function(tree){
    check.na &lt;- try(sum(is.na(tree$edge.length))&gt;0)
    if(is(check.na, &quot;try-error&quot;) | check.na)
      NULL
    else
    try( chronoMPL(multi2di(tree)) )
}
drop_errors &lt;- function(tr){
  tt &lt;- tr[!sapply(tr, is.null)]
  tt &lt;- tt[!sapply(tt, function(x) is(x, &quot;try-error&quot;))]
  print(paste(&quot;dropped&quot;, length(tr)-length(tt), &quot;trees&quot;))
  tt
}
require(laser)
pick_branching_model &lt;- function(tree){
  m1 &lt;- try(pureBirth(branching.times(tree)))
  m2 &lt;- try(bd(branching.times(tree)))
  as.logical(try(m2$aic &lt; m1$aic))
}
</code></pre>

<p>Returna somente as árvores do treebase que contêm comprimentos de ramo. Este passo baixa todas as árvores do treebase, então pode demorar um pouco. Ainda bem que não temos de fazer isso manualmente :) .</p>

<pre><code class="language-r">all &lt;- search_treebase(&quot;Consensus&quot;, &quot;type.tree&quot;, branch_lengths=TRUE)
tt &lt;- drop_errors(sapply(all, timetree))
is_yule &lt;- sapply(tt, pick_branching_model)
table(is_yule)
</code></pre>

<p><em>Note que o resultado não é mostrado, mas roda no fundo!</em></p>

<p><section id="citing"></p>

<h2 id="citação">Citação</h2>

<p>Para citar o <code>treebase</code> numa publicação, use:</p>

<p><br></p>

<blockquote>
<p>Carl Boettiger and Duncan Temple Lang (2011). treebase: An R package for discovery, access and manipulation of online phylogenies. R package version 0.0-7.1. <a href="https://github.com/ropensci/treebase">https://github.com/ropensci/treebase</a></p>
</blockquote>

<p><section id="license_bugs"></p>

<h2 id="licença-e-erros">Licença e erros</h2>

<ul>
<li>Licença: <a href="http://creativecommons.org/choose/zero/">CC0</a></li>
<li>Relatório de error em <a href="https://github.com/ropensci/treebase/issues?state=open">our Github repo for treebase</a></li>
</ul>

<p><a href="#top">Back to top</a></p>

                    </article>
                </div>

                </div>
            </div>
        </div>
    </article>


    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>




    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    

    
    <script type="text/javascript" src="/js/highlight.pack.js"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>



</body>
</html>
