<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>rOpenSci | rerddap tutorial</title>

     
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style-new.css" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4b8add">
<meta name="theme-color" content="#4b8add">


    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

    
    <div id="header">
        <div class="container">
            <div class="row center-m">
                
                <div class="col-1">
                    <a href="/index.html"><img src="/img/icon_lettering_white.svg" /></a>
                </div>
                
                
                <nav class="col-6 col-offset-4 top-3">
                    <ul class="row between">
						<li><a href="/about/">About</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/packages/">Packages</a></li>
                        <li><a href="/community/">Community</a></li>
                        <li><a href="http://discuss.ropensci.org/" target="_blank">Discuss</a></li>

                    </ul>
                </nav>
                
            </div>
        </div>
    </div>



    <article>
        <div class="container top-20">
            
            <div class="row centered">
                
                <div class="col-7 bottom-20 maintext">
                    <h1>rerddap tutorial</h1>
                    <br>
                    <h4><small style="color:grey">for v0.4.2</small></h4>
                    <br>

                    <article>
                    

<p><code>rerddap</code> is a general purpose R client for working with ERDDAP servers. ERDDAP is a server built on top of OPenDAP, which serves some NOAA data. You can get gridded data (<a href="http://upwell.pfeg.noaa.gov/erddap/griddap/documentation.html">griddap</a>), which lets you query from gridded datasets, or table data (<a href="http://upwell.pfeg.noaa.gov/erddap/tabledap/documentation.html">tabledap</a>) which lets you query from tabular datasets. In terms of how we interface with them, there are similarties, but some differences too. We try to make a similar interface to both data types in <code>rerddap</code>.</p>

<h2 id="netcdf">netCDF</h2>

<p><code>rerddap</code> supports netCDF format, and is the default when using the <code>griddap()</code> function. netCDF is a binary file format, and will have a much smaller footprint on your disk than csv. The binary file format means it&rsquo;s harder to inspect, but the <code>ncdf</code> and <code>ncdf4</code> packages make it easy to pull data out and write data back into a netCDF file. Note the the file extension for netCDF files is <code>.nc</code>. Whether you choose netCDF or csv for small files won&rsquo;t make much of a difference, but will with large files.</p>

<h2 id="caching">Caching</h2>

<p>Data files downloaded are cached in a single hidden directory <code>~/.rerddap</code> on your machine. It&rsquo;s hidden so that you don&rsquo;t accidentally delete the data, but you can still easily delete the data if you like.</p>

<p>When you use <code>griddap()</code> or <code>tabledap()</code> functions, we construct a MD5 hash from the base URL, and any query parameters - this way each query is separately cached. Once we have the hash, we look in <code>~/.rerddap</code> for a matching hash. If there&rsquo;s a match we use that file on disk - if no match, we make a http request for the data to the ERDDAP server you specify.</p>

<h2 id="erddap-servers">ERDDAP servers</h2>

<p>You can get a data.frame of ERDDAP servers using the function <code>servers()</code>. Most I think serve some kind of NOAA data, but there are a few that aren&rsquo;t NOAA data.  If you know of more ERDDAP servers, send a pull request, or let us know.</p>

<h3 id="installation">Installation</h3>

<p>Stable version from CRAN</p>

<pre><code class="language-r">install.packages(&quot;rerddap&quot;)
</code></pre>

<p>Or, the development version from GitHub</p>

<pre><code class="language-r">devtools::install_github(&quot;ropensci/rerddap&quot;)
</code></pre>

<pre><code class="language-r">library(&quot;rerddap&quot;)
</code></pre>

<h3 id="search">Search</h3>

<p>First, you likely want to search for data, specify either <code>griddadp</code> or <code>tabledap</code></p>

<pre><code class="language-r">ed_search(query = 'size', which = &quot;table&quot;)
#&gt; # A tibble: 10 x 2
#&gt;                                                                          title
#&gt;                                                                          &lt;chr&gt;
#&gt;  1                                                        CalCOFI Larvae Sizes
#&gt;  2 Channel Islands, Kelp Forest Monitoring, Size and Frequency, Natural Habita
#&gt;  3             NWFSC Observer Fixed Gear Data, off West Coast of US, 2002-2006
#&gt;  4                  NWFSC Observer Trawl Data, off West Coast of US, 2002-2006
#&gt;  5                                         CalCOFI Larvae Counts Positive Tows
#&gt;  6                                                                CalCOFI Tows
#&gt;  7                          GLOBEC NEP MOCNESS Plankton (MOC1) Data, 2000-2002
#&gt;  8                      GLOBEC NEP Vertical Plankton Tow (VPT) Data, 1997-2001
#&gt;  9                                  OBIS - ARGOS Satellite Tracking of Animals
#&gt; 10 AN EXPERIMENTAL DATASET: Underway Sea Surface Temperature and Salinity Aboa
#&gt; # ... with 1 more variables: dataset_id &lt;chr&gt;
</code></pre>

<pre><code class="language-r">ed_search(query = 'size', which = &quot;grid&quot;)
#&gt; # A tibble: 290 x 2
#&gt;                                                                          title
#&gt;                                                                          &lt;chr&gt;
#&gt;  1 COAWST Hindcast:MVCO/CBlast 2007:ripples with SWAN-40m res (00 dir roms) [t
#&gt;  2 COAWST Hindcast:MVCO/CBlast 2007:ripples with SWAN-40m res (00 dir roms) [t
#&gt;  3 COAWST Hindcast:MVCO/CBlast 2007:ripples with SWAN-40m res (00 dir roms) [t
#&gt;  4 COAWST Hindcast:MVCO/CBlast 2007:ripples with SWAN-40m res (00 dir roms) [t
#&gt;  5 COAWST Hindcast:MVCO/CBlast 2007:ripples with SWAN-40m res (00 dir roms) [t
#&gt;  6 ROMS3.0 CBLAST2007 Ripples with SWAN-40m res (his case7 ar0fd 0021) [time][
#&gt;  7 ROMS3.0 CBLAST2007 Ripples with SWAN-40m res (his case7 ar0fd 0021) [time][
#&gt;  8 ROMS3.0 CBLAST2007 Ripples with SWAN-40m res (his case7 ar0fd 0021) [time][
#&gt;  9 ROMS3.0 CBLAST2007 Ripples with SWAN-40m res (his case7 ar0fd 0021) [time][
#&gt; 10 ROMS3.0 CBLAST2007 Ripples with SWAN-40m res (his case7 ar0fd 0021) [time][
#&gt; # ... with 280 more rows, and 1 more variables: dataset_id &lt;chr&gt;
</code></pre>

<h3 id="information">Information</h3>

<p>Then you can get information on a single dataset</p>

<pre><code class="language-r">info('erdCalCOFIlrvsiz')
#&gt; &lt;ERDDAP info&gt; erdCalCOFIlrvsiz 
#&gt;  Variables:  
#&gt;      calcofi_species_code: 
#&gt;          Range: 19, 9760 
#&gt;      common_name: 
#&gt;      cruise: 
#&gt;      itis_tsn: 
#&gt;      larvae_1000m3: 
#&gt;          Units: Fish larvae per 1,000 cubic meters of water sampled 
#&gt;      larvae_10m2: 
...
</code></pre>

<h3 id="griddap-gridded-data">griddap (gridded) data</h3>

<p>First, get information on a dataset to see time range, lat/long range, and variables.</p>

<pre><code class="language-r">(out &lt;- info('noaa_esrl_027d_0fb5_5d38'))
#&gt; &lt;ERDDAP info&gt; noaa_esrl_027d_0fb5_5d38 
#&gt;  Dimensions (range):  
#&gt;      time: (1850-01-01T00:00:00Z, 2014-05-01T00:00:00Z) 
#&gt;      latitude: (87.5, -87.5) 
#&gt;      longitude: (-177.5, 177.5) 
#&gt;  Variables:  
#&gt;      air: 
#&gt;          Range: -20.9, 19.5 
#&gt;          Units: degC
</code></pre>

<p>Then query for gridded data using the <code>griddap()</code> function</p>

<pre><code class="language-r">(res &lt;- griddap(out,
  time = c('2012-01-01', '2012-01-30'),
  latitude = c(21, 10),
  longitude = c(-80, -70)
))
#&gt; &lt;ERDDAP griddap&gt; noaa_esrl_027d_0fb5_5d38
#&gt;    Path: [/Users/sacmac/Library/Caches/R/rdpla/1a664ce4d6af316b611ac5a74a68d704.nc]
#&gt;    Last updated: [2017-10-17 11:58:34]
#&gt;    File size:    [0 mb]
#&gt;    Dimensions (dims/vars):   [3 X 1]
#&gt;    Dim names: time, latitude, longitude
#&gt;    Variable names: CRUTEM3: Surface Air Temperature Monthly Anomaly
#&gt;    data.frame (rows/columns):   [18 X 4]
#&gt; # A tibble: 18 x 4
#&gt;                    time   lat   lon   air
#&gt;                   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1 2012-01-01T00:00:00Z  22.5 -77.5    NA
#&gt;  2 2012-01-01T00:00:00Z  22.5 -72.5    NA
#&gt;  3 2012-01-01T00:00:00Z  22.5 -67.5    NA
#&gt;  4 2012-01-01T00:00:00Z  17.5 -77.5 -0.10
#&gt;  5 2012-01-01T00:00:00Z  17.5 -72.5    NA
#&gt;  6 2012-01-01T00:00:00Z  17.5 -67.5 -0.20
#&gt;  7 2012-01-01T00:00:00Z  12.5 -77.5  0.20
#&gt;  8 2012-01-01T00:00:00Z  12.5 -72.5    NA
#&gt;  9 2012-01-01T00:00:00Z  12.5 -67.5  0.30
#&gt; 10 2012-02-01T00:00:00Z  22.5 -77.5    NA
#&gt; 11 2012-02-01T00:00:00Z  22.5 -72.5    NA
#&gt; 12 2012-02-01T00:00:00Z  22.5 -67.5    NA
#&gt; 13 2012-02-01T00:00:00Z  17.5 -77.5  0.40
#&gt; 14 2012-02-01T00:00:00Z  17.5 -72.5    NA
#&gt; 15 2012-02-01T00:00:00Z  17.5 -67.5  0.20
#&gt; 16 2012-02-01T00:00:00Z  12.5 -77.5  0.00
#&gt; 17 2012-02-01T00:00:00Z  12.5 -72.5    NA
#&gt; 18 2012-02-01T00:00:00Z  12.5 -67.5  0.32
</code></pre>

<p>The output of <code>griddap()</code> is a list that you can explore further. Get the summary</p>

<pre><code class="language-r">res$summary
#&gt; $filename
#&gt; [1] &quot;/Users/sacmac/Library/Caches/R/rdpla/1a664ce4d6af316b611ac5a74a68d704.nc&quot;
#&gt; 
#&gt; $writable
#&gt; [1] FALSE
#&gt; 
#&gt; $id
#&gt; [1] 65536
#&gt; 
#&gt; $safemode
#&gt; [1] FALSE
#&gt; 
#&gt; $format
#&gt; [1] &quot;NC_FORMAT_CLASSIC&quot;
#&gt; 
...
</code></pre>

<p>Get the dimension variables</p>

<pre><code class="language-r">names(res$summary$dim)
#&gt; [1] &quot;time&quot;      &quot;latitude&quot;  &quot;longitude&quot;
</code></pre>

<p>Get the data.frame (beware: you may want to just look at the <code>head</code> of the data.frame if large)</p>

<pre><code class="language-r">res$data
#&gt;                    time  lat   lon   air
#&gt; 1  2012-01-01T00:00:00Z 22.5 -77.5    NA
#&gt; 2  2012-01-01T00:00:00Z 22.5 -72.5    NA
#&gt; 3  2012-01-01T00:00:00Z 22.5 -67.5    NA
#&gt; 4  2012-01-01T00:00:00Z 17.5 -77.5 -0.10
#&gt; 5  2012-01-01T00:00:00Z 17.5 -72.5    NA
#&gt; 6  2012-01-01T00:00:00Z 17.5 -67.5 -0.20
#&gt; 7  2012-01-01T00:00:00Z 12.5 -77.5  0.20
#&gt; 8  2012-01-01T00:00:00Z 12.5 -72.5    NA
#&gt; 9  2012-01-01T00:00:00Z 12.5 -67.5  0.30
#&gt; 10 2012-02-01T00:00:00Z 22.5 -77.5    NA
#&gt; 11 2012-02-01T00:00:00Z 22.5 -72.5    NA
#&gt; 12 2012-02-01T00:00:00Z 22.5 -67.5    NA
#&gt; 13 2012-02-01T00:00:00Z 17.5 -77.5  0.40
#&gt; 14 2012-02-01T00:00:00Z 17.5 -72.5    NA
#&gt; 15 2012-02-01T00:00:00Z 17.5 -67.5  0.20
#&gt; 16 2012-02-01T00:00:00Z 12.5 -77.5  0.00
#&gt; 17 2012-02-01T00:00:00Z 12.5 -72.5    NA
#&gt; 18 2012-02-01T00:00:00Z 12.5 -67.5  0.32
</code></pre>

<h3 id="tabledap-tabular-data">tabledap (tabular) data</h3>

<pre><code class="language-r">(out &lt;- info('erdCalCOFIlrvsiz'))
#&gt; &lt;ERDDAP info&gt; erdCalCOFIlrvsiz 
#&gt;  Variables:  
#&gt;      calcofi_species_code: 
#&gt;          Range: 19, 9760 
#&gt;      common_name: 
#&gt;      cruise: 
#&gt;      itis_tsn: 
#&gt;      larvae_1000m3: 
#&gt;          Units: Fish larvae per 1,000 cubic meters of water sampled 
#&gt;      larvae_10m2: 
...
</code></pre>

<pre><code class="language-r">(dat &lt;- tabledap(out, 'time&gt;=2011-01-01', 'time&lt;=2011-12-31', fields = c('longitude', 'latitude', 'larvae_size', 'scientific_name')))
#&gt; &lt;ERDDAP tabledap&gt; erdCalCOFIlrvsiz
#&gt;    Path: [/Users/sacmac/Library/Caches/R/rdpla/c08c5d45ecceae143cd67258f5c9c5fa.csv]
#&gt;    Last updated: [2017-10-17 12:00:32]
#&gt;    File size:    [0.05 mb]
#&gt; # A tibble: 1,217 x 4
#&gt;    longitude  latitude larvae_size        scientific_name
#&gt;  *     &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;                  &lt;chr&gt;
#&gt;  1  -117.305 32.956665         4.5       Engraulis mordax
#&gt;  2  -117.305 32.956665         2.9 Doryteuthis opalescens
#&gt;  3  -117.305 32.956665         2.7 Doryteuthis opalescens
#&gt;  4  -117.305 32.956665         3.3 Doryteuthis opalescens
#&gt;  5  -117.305 32.956665         3.0 Doryteuthis opalescens
#&gt;  6  -117.305 32.956665         3.7 Doryteuthis opalescens
#&gt;  7  -117.305 32.956665         3.4 Doryteuthis opalescens
#&gt;  8  -117.305 32.956665         3.2 Doryteuthis opalescens
#&gt;  9  -117.305 32.956665         2.8 Doryteuthis opalescens
#&gt; 10  -117.305 32.956665         3.6 Doryteuthis opalescens
#&gt; # ... with 1,207 more rows
</code></pre>

<p>Since both <code>griddap()</code> and <code>tabledap()</code> give back data.frame&rsquo;s, it&rsquo;s easy to do downstream manipulation. For example, we can use <code>dplyr</code> to filter, summarize, group, and sort:</p>

<pre><code class="language-r">library(&quot;dplyr&quot;)
dat$larvae_size &lt;- as.numeric(dat$larvae_size)
dat %&gt;%
  group_by(scientific_name) %&gt;%
  summarise(mean_size = mean(larvae_size)) %&gt;%
  arrange(desc(mean_size))
#&gt; # A tibble: 6 x 2
#&gt;          scientific_name mean_size
#&gt;                    &lt;chr&gt;     &lt;dbl&gt;
#&gt; 1       Engraulis mordax  8.446067
#&gt; 2        Sardinops sagax  5.828738
#&gt; 3   Merluccius productus  5.512176
#&gt; 4 Doryteuthis opalescens  3.653363
#&gt; 5      Scomber japonicus  3.400000
#&gt; 6  Trachurus symmetricus  3.264444
</code></pre>

<h3 id="citing">Citing</h3>

<p>To cite <code>rerddap</code> in publications use:</p>

<p><br></p>

<blockquote>
<p>Scott Chamberlain (2017). rerddap: General Purpose Client for
  &lsquo;ERDDAP&rsquo; Servers. R package version 0.4.2.
  <a href="https://CRAN.R-project.org/package=rerddap">https://CRAN.R-project.org/package=rerddap</a></p>
</blockquote>

<p>##E License and bugs</p>

<ul>
<li>License: <a href="http://opensource.org/licenses/MIT">MIT</a></li>
<li>Report bugs at <a href="https://github.com/ropensci/rerddap/issues?state=open">our Github repo for rerddap</a></li>
</ul>

<p><a href="#top">Back to top</a></p>

                    </article>
                </div>

                </div>
            </div>
        </div>
    </article>


    <div id="footer">
        <div class="container">
            <div class="row start">
                <div class="col-1 col-1-3 top-8">
                    <img src="/img/icon_short_white.svg" />
                </div>

                <div class="col-9 col-offset-2 top-10 bottom-8">
                    <div class="row between">
                        <div class="col-2 col-1-3">
                            <a href="http://github.com/ropensci" target="_blank"><div class="icon icon-github"></div></a>
                            <a href="http://twitter.com/ropensci" target="_blank"><div class="icon icon-twitter"></div></a>
                            <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon icon-vimeo"></div></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Info</h5>
                                <li><a href="/about">Mission</a></li>
                                <li><a href="/about#team">Team</a></li>
                                <li><a href="/about#collaborators">Collaborators</a></li>
                                <li><a href="/careers">Careers</a></li>

                            </ul>
                        </div>

                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Work</h5>
                                <li><a href="/packages/">Packages</a></li>
                                <li><a href="/blog/">Blog</a></li>
                                <li><a href="/technotes/">Tech Notes</a></li>
                                <li><a href="/tutorials/">Tutorials</a></li>
                                <li><a href="/usecases/">Use Cases</a></li>
                                <li><a href="/resources/">More Resources</a></li>
                            </ul>
                        </div>
                        <div class="col-2 col-1-3 top-8 bottom-8">
                            <ul>
                                <h5 class="bottom-2">Participate</h5>
                                <li><a href="/contact.html">Contact us</a></li>
                                <li><a href="/community/">Community</a></li>
                                <li><a href="http://onboarding.ropensci.org/">Contribute software</a></li>
                                <li><a href="http://unconf17.ropensci.org/">Unconference</a></li>
                                <li><a href="/coc">Code of conduct</a></li>
                                <li><a href="/donate/">Donate</a></li>
                            </ul>
                        </div>
                        <div class="col-4 top-8 bottom-8">
                            <h5 class="bottom-2"></h5>

                            <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                            <a href="http://numfocus.org" target="_blank"><img src="img/numfocus.png"></a>
                            <br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 top-8 bottom-9 divider">
                    <p class="top-9">Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY license</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>




    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    

    
    <script type="text/javascript" src="/js/highlight.pack.js"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>



</body>
</html>
